<!DOCTYPE html>
<HTML lang = "en">
<HEAD>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>A comprehensive introduction to Pumas - Part 1</title>
  

  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
      TeX: { equationNumbers: { autoNumber: "AMS" } }
    });
  </script>

  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>

  
<style>
pre.hljl {
    border: 1px solid #ccc;
    margin: 5px;
    padding: 5px;
    overflow-x: auto;
    color: rgb(68,68,68); background-color: rgb(251,251,251); }
pre.hljl > span.hljl-t { }
pre.hljl > span.hljl-w { }
pre.hljl > span.hljl-e { }
pre.hljl > span.hljl-eB { }
pre.hljl > span.hljl-o { }
pre.hljl > span.hljl-k { color: rgb(148,91,176); font-weight: bold; }
pre.hljl > span.hljl-kc { color: rgb(59,151,46); font-style: italic; }
pre.hljl > span.hljl-kd { color: rgb(214,102,97); font-style: italic; }
pre.hljl > span.hljl-kn { color: rgb(148,91,176); font-weight: bold; }
pre.hljl > span.hljl-kp { color: rgb(148,91,176); font-weight: bold; }
pre.hljl > span.hljl-kr { color: rgb(148,91,176); font-weight: bold; }
pre.hljl > span.hljl-kt { color: rgb(148,91,176); font-weight: bold; }
pre.hljl > span.hljl-n { }
pre.hljl > span.hljl-na { }
pre.hljl > span.hljl-nb { }
pre.hljl > span.hljl-nbp { }
pre.hljl > span.hljl-nc { }
pre.hljl > span.hljl-ncB { }
pre.hljl > span.hljl-nd { color: rgb(214,102,97); }
pre.hljl > span.hljl-ne { }
pre.hljl > span.hljl-neB { }
pre.hljl > span.hljl-nf { color: rgb(66,102,213); }
pre.hljl > span.hljl-nfm { color: rgb(66,102,213); }
pre.hljl > span.hljl-np { }
pre.hljl > span.hljl-nl { }
pre.hljl > span.hljl-nn { }
pre.hljl > span.hljl-no { }
pre.hljl > span.hljl-nt { }
pre.hljl > span.hljl-nv { }
pre.hljl > span.hljl-nvc { }
pre.hljl > span.hljl-nvg { }
pre.hljl > span.hljl-nvi { }
pre.hljl > span.hljl-nvm { }
pre.hljl > span.hljl-l { }
pre.hljl > span.hljl-ld { color: rgb(148,91,176); font-style: italic; }
pre.hljl > span.hljl-s { color: rgb(201,61,57); }
pre.hljl > span.hljl-sa { color: rgb(201,61,57); }
pre.hljl > span.hljl-sb { color: rgb(201,61,57); }
pre.hljl > span.hljl-sc { color: rgb(201,61,57); }
pre.hljl > span.hljl-sd { color: rgb(201,61,57); }
pre.hljl > span.hljl-sdB { color: rgb(201,61,57); }
pre.hljl > span.hljl-sdC { color: rgb(201,61,57); }
pre.hljl > span.hljl-se { color: rgb(59,151,46); }
pre.hljl > span.hljl-sh { color: rgb(201,61,57); }
pre.hljl > span.hljl-si { }
pre.hljl > span.hljl-so { color: rgb(201,61,57); }
pre.hljl > span.hljl-sr { color: rgb(201,61,57); }
pre.hljl > span.hljl-ss { color: rgb(201,61,57); }
pre.hljl > span.hljl-ssB { color: rgb(201,61,57); }
pre.hljl > span.hljl-nB { color: rgb(59,151,46); }
pre.hljl > span.hljl-nbB { color: rgb(59,151,46); }
pre.hljl > span.hljl-nfB { color: rgb(59,151,46); }
pre.hljl > span.hljl-nh { color: rgb(59,151,46); }
pre.hljl > span.hljl-ni { color: rgb(59,151,46); }
pre.hljl > span.hljl-nil { color: rgb(59,151,46); }
pre.hljl > span.hljl-noB { color: rgb(59,151,46); }
pre.hljl > span.hljl-oB { color: rgb(102,102,102); font-weight: bold; }
pre.hljl > span.hljl-ow { color: rgb(102,102,102); font-weight: bold; }
pre.hljl > span.hljl-p { }
pre.hljl > span.hljl-c { color: rgb(153,153,119); font-style: italic; }
pre.hljl > span.hljl-ch { color: rgb(153,153,119); font-style: italic; }
pre.hljl > span.hljl-cm { color: rgb(153,153,119); font-style: italic; }
pre.hljl > span.hljl-cp { color: rgb(153,153,119); font-style: italic; }
pre.hljl > span.hljl-cpB { color: rgb(153,153,119); font-style: italic; }
pre.hljl > span.hljl-cs { color: rgb(153,153,119); font-style: italic; }
pre.hljl > span.hljl-csB { color: rgb(153,153,119); font-style: italic; }
pre.hljl > span.hljl-g { }
pre.hljl > span.hljl-gd { }
pre.hljl > span.hljl-ge { }
pre.hljl > span.hljl-geB { }
pre.hljl > span.hljl-gh { }
pre.hljl > span.hljl-gi { }
pre.hljl > span.hljl-go { }
pre.hljl > span.hljl-gp { }
pre.hljl > span.hljl-gs { }
pre.hljl > span.hljl-gsB { }
pre.hljl > span.hljl-gt { }
</style>



  <style type="text/css">
  @font-face {
  font-style: normal;
  font-weight: 300;
}
@font-face {
  font-style: normal;
  font-weight: 400;
}
@font-face {
  font-style: normal;
  font-weight: 600;
}
html {
  font-family: sans-serif; /* 1 */
  -ms-text-size-adjust: 100%; /* 2 */
  -webkit-text-size-adjust: 100%; /* 2 */
}
body {
  margin: 0;
}
article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
menu,
nav,
section,
summary {
  display: block;
}
audio,
canvas,
progress,
video {
  display: inline-block; /* 1 */
  vertical-align: baseline; /* 2 */
}
audio:not([controls]) {
  display: none;
  height: 0;
}
[hidden],
template {
  display: none;
}
a:active,
a:hover {
  outline: 0;
}
abbr[title] {
  border-bottom: 1px dotted;
}
b,
strong {
  font-weight: bold;
}
dfn {
  font-style: italic;
}
h1 {
  font-size: 2em;
  margin: 0.67em 0;
}
mark {
  background: #ff0;
  color: #000;
}
small {
  font-size: 80%;
}
sub,
sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
sup {
  top: -0.5em;
}
sub {
  bottom: -0.25em;
}
img {
  border: 0;
}
svg:not(:root) {
  overflow: hidden;
}
figure {
  margin: 1em 40px;
}
hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0;
}
pre {
  overflow: auto;
}
code,
kbd,
pre,
samp {
  font-family: monospace, monospace;
  font-size: 1em;
}
button,
input,
optgroup,
select,
textarea {
  color: inherit; /* 1 */
  font: inherit; /* 2 */
  margin: 0; /* 3 */
}
button {
  overflow: visible;
}
button,
select {
  text-transform: none;
}
button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
  -webkit-appearance: button; /* 2 */
  cursor: pointer; /* 3 */
}
button[disabled],
html input[disabled] {
  cursor: default;
}
button::-moz-focus-inner,
input::-moz-focus-inner {
  border: 0;
  padding: 0;
}
input {
  line-height: normal;
}
input[type="checkbox"],
input[type="radio"] {
  box-sizing: border-box; /* 1 */
  padding: 0; /* 2 */
}
input[type="number"]::-webkit-inner-spin-button,
input[type="number"]::-webkit-outer-spin-button {
  height: auto;
}
input[type="search"] {
  -webkit-appearance: textfield; /* 1 */
  -moz-box-sizing: content-box;
  -webkit-box-sizing: content-box; /* 2 */
  box-sizing: content-box;
}
input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
  -webkit-appearance: none;
}
fieldset {
  border: 1px solid #c0c0c0;
  margin: 0 2px;
  padding: 0.35em 0.625em 0.75em;
}
legend {
  border: 0; /* 1 */
  padding: 0; /* 2 */
}
textarea {
  overflow: auto;
}
optgroup {
  font-weight: bold;
}
table {
  font-family: monospace, monospace;
  font-size : 0.8em;
  border-collapse: collapse;
  border-spacing: 0;
}
td,
th {
  padding: 0;
}
thead th {
    border-bottom: 1px solid black;
    background-color: white;
}
tr:nth-child(odd){
  background-color: rgb(248,248,248);
}


/*
* Skeleton V2.0.4
* Copyright 2014, Dave Gamache
* www.getskeleton.com
* Free to use under the MIT license.
* http://www.opensource.org/licenses/mit-license.php
* 12/29/2014
*/
.container {
  position: relative;
  width: 100%;
  max-width: 960px;
  margin: 0 auto;
  padding: 0 20px;
  box-sizing: border-box; }
.column,
.columns {
  width: 100%;
  float: left;
  box-sizing: border-box; }
@media (min-width: 400px) {
  .container {
    width: 85%;
    padding: 0; }
}
@media (min-width: 550px) {
  .container {
    width: 80%; }
  .column,
  .columns {
    margin-left: 4%; }
  .column:first-child,
  .columns:first-child {
    margin-left: 0; }

  .one.column,
  .one.columns                    { width: 4.66666666667%; }
  .two.columns                    { width: 13.3333333333%; }
  .three.columns                  { width: 22%;            }
  .four.columns                   { width: 30.6666666667%; }
  .five.columns                   { width: 39.3333333333%; }
  .six.columns                    { width: 48%;            }
  .seven.columns                  { width: 56.6666666667%; }
  .eight.columns                  { width: 65.3333333333%; }
  .nine.columns                   { width: 74.0%;          }
  .ten.columns                    { width: 82.6666666667%; }
  .eleven.columns                 { width: 91.3333333333%; }
  .twelve.columns                 { width: 100%; margin-left: 0; }

  .one-third.column               { width: 30.6666666667%; }
  .two-thirds.column              { width: 65.3333333333%; }

  .one-half.column                { width: 48%; }

  /* Offsets */
  .offset-by-one.column,
  .offset-by-one.columns          { margin-left: 8.66666666667%; }
  .offset-by-two.column,
  .offset-by-two.columns          { margin-left: 17.3333333333%; }
  .offset-by-three.column,
  .offset-by-three.columns        { margin-left: 26%;            }
  .offset-by-four.column,
  .offset-by-four.columns         { margin-left: 34.6666666667%; }
  .offset-by-five.column,
  .offset-by-five.columns         { margin-left: 43.3333333333%; }
  .offset-by-six.column,
  .offset-by-six.columns          { margin-left: 52%;            }
  .offset-by-seven.column,
  .offset-by-seven.columns        { margin-left: 60.6666666667%; }
  .offset-by-eight.column,
  .offset-by-eight.columns        { margin-left: 69.3333333333%; }
  .offset-by-nine.column,
  .offset-by-nine.columns         { margin-left: 78.0%;          }
  .offset-by-ten.column,
  .offset-by-ten.columns          { margin-left: 86.6666666667%; }
  .offset-by-eleven.column,
  .offset-by-eleven.columns       { margin-left: 95.3333333333%; }

  .offset-by-one-third.column,
  .offset-by-one-third.columns    { margin-left: 34.6666666667%; }
  .offset-by-two-thirds.column,
  .offset-by-two-thirds.columns   { margin-left: 69.3333333333%; }

  .offset-by-one-half.column,
  .offset-by-one-half.columns     { margin-left: 52%; }

}
html {
  font-size: 62.5%; }
body {
  font-size: 1.5em; /* currently ems cause chrome bug misinterpreting rems on body element */
  line-height: 1.6;
  font-weight: 400;
  font-family: "Raleway", "HelveticaNeue", "Helvetica Neue", Helvetica, Arial, sans-serif;
  color: #222; }
h1, h2, h3, h4, h5, h6 {
  margin-top: 0;
  margin-bottom: 2rem;
  font-weight: 300; }
h1 { font-size: 3.6rem; line-height: 1.2;  letter-spacing: -.1rem;}
h2 { font-size: 3.4rem; line-height: 1.25; letter-spacing: -.1rem; }
h3 { font-size: 3.2rem; line-height: 1.3;  letter-spacing: -.1rem; }
h4 { font-size: 2.8rem; line-height: 1.35; letter-spacing: -.08rem; }
h5 { font-size: 2.4rem; line-height: 1.5;  letter-spacing: -.05rem; }
h6 { font-size: 1.5rem; line-height: 1.6;  letter-spacing: 0; }

p {
  margin-top: 0; }
a {
  color: #1EAEDB; }
a:hover {
  color: #0FA0CE; }
.button,
button,
input[type="submit"],
input[type="reset"],
input[type="button"] {
  display: inline-block;
  height: 38px;
  padding: 0 30px;
  color: #555;
  text-align: center;
  font-size: 11px;
  font-weight: 600;
  line-height: 38px;
  letter-spacing: .1rem;
  text-transform: uppercase;
  text-decoration: none;
  white-space: nowrap;
  background-color: transparent;
  border-radius: 4px;
  border: 1px solid #bbb;
  cursor: pointer;
  box-sizing: border-box; }
.button:hover,
button:hover,
input[type="submit"]:hover,
input[type="reset"]:hover,
input[type="button"]:hover,
.button:focus,
button:focus,
input[type="submit"]:focus,
input[type="reset"]:focus,
input[type="button"]:focus {
  color: #333;
  border-color: #888;
  outline: 0; }
.button.button-primary,
button.button-primary,
input[type="submit"].button-primary,
input[type="reset"].button-primary,
input[type="button"].button-primary {
  color: #FFF;
  background-color: #33C3F0;
  border-color: #33C3F0; }
.button.button-primary:hover,
button.button-primary:hover,
input[type="submit"].button-primary:hover,
input[type="reset"].button-primary:hover,
input[type="button"].button-primary:hover,
.button.button-primary:focus,
button.button-primary:focus,
input[type="submit"].button-primary:focus,
input[type="reset"].button-primary:focus,
input[type="button"].button-primary:focus {
  color: #FFF;
  background-color: #1EAEDB;
  border-color: #1EAEDB; }
input[type="email"],
input[type="number"],
input[type="search"],
input[type="text"],
input[type="tel"],
input[type="url"],
input[type="password"],
textarea,
select {
  height: 38px;
  padding: 6px 10px; /* The 6px vertically centers text on FF, ignored by Webkit */
  background-color: #fff;
  border: 1px solid #D1D1D1;
  border-radius: 4px;
  box-shadow: none;
  box-sizing: border-box; }
/* Removes awkward default styles on some inputs for iOS */
input[type="email"],
input[type="number"],
input[type="search"],
input[type="text"],
input[type="tel"],
input[type="url"],
input[type="password"],
textarea {
  -webkit-appearance: none;
     -moz-appearance: none;
          appearance: none; }
textarea {
  min-height: 65px;
  padding-top: 6px;
  padding-bottom: 6px; }
input[type="email"]:focus,
input[type="number"]:focus,
input[type="search"]:focus,
input[type="text"]:focus,
input[type="tel"]:focus,
input[type="url"]:focus,
input[type="password"]:focus,
textarea:focus,
select:focus {
  border: 1px solid #33C3F0;
  outline: 0; }
label,
legend {
  display: block;
  margin-bottom: .5rem;
  font-weight: 600; }
fieldset {
  padding: 0;
  border-width: 0; }
input[type="checkbox"],
input[type="radio"] {
  display: inline; }
label > .label-body {
  display: inline-block;
  margin-left: .5rem;
  font-weight: normal; }
ul {
  list-style: circle; }
ol {
  list-style: decimal; }
ul ul,
ul ol,
ol ol,
ol ul {
  margin: 1.5rem 0 1.5rem 3rem;
  font-size: 90%; }
li > p {margin : 0;}
th,
td {
  padding: 12px 15px;
  text-align: left;
  border-bottom: 1px solid #E1E1E1; }
th:first-child,
td:first-child {
  padding-left: 0; }
th:last-child,
td:last-child {
  padding-right: 0; }
button,
.button {
  margin-bottom: 1rem; }
input,
textarea,
select,
fieldset {
  margin-bottom: 1.5rem; }
pre,
blockquote,
dl,
figure,
table,
p,
ul,
ol,
form {
  margin-bottom: 1.0rem; }
.u-full-width {
  width: 100%;
  box-sizing: border-box; }
.u-max-full-width {
  max-width: 100%;
  box-sizing: border-box; }
.u-pull-right {
  float: right; }
.u-pull-left {
  float: left; }
hr {
  margin-top: 3rem;
  margin-bottom: 3.5rem;
  border-width: 0;
  border-top: 1px solid #E1E1E1; }
.container:after,
.row:after,
.u-cf {
  content: "";
  display: table;
  clear: both; }

pre {
  display: block;
  padding: 9.5px;
  margin: 0 0 10px;
  font-size: 13px;
  line-height: 1.42857143;
  word-break: break-all;
  word-wrap: break-word;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre.hljl {
  margin: 0 0 10px;
  display: block;
  background: #f5f5f5;
  border-radius: 4px;
  padding : 5px;
}

pre.output {
  background: #ffffff;
}

pre.code {
  background: #ffffff;
}

pre.julia-error {
  color : red
}

code,
kbd,
pre,
samp {
  font-family: Menlo, Monaco, Consolas, "Courier New", monospace;
  font-size: 0.9em;
}


@media (min-width: 400px) {}
@media (min-width: 550px) {}
@media (min-width: 750px) {}
@media (min-width: 1000px) {}
@media (min-width: 1200px) {}

h1.title {margin-top : 20px}
img {max-width : 100%}
div.title {text-align: center;}

  </style>
</HEAD>

<BODY>
  <div class ="container">
    <div class = "row">
      <div class = "col-md-12 twelve columns">
        <div class="title">
          <h1 class="title">A comprehensive introduction to Pumas - Part 1</h1>
          
          <h5>2020-08-09</h5>
        </div>

        
<h1>Introduction</h1>
<p>This tutorial provides a comprehensive introduction to a modeling and simulation workflow in Pumas. This tutorial will not get into the details of Pumas specifics, but instead provide a narrative on the lines of a regular workflow in our day to day work, with brevity where required to allow a broad overview. Wherever possible, cross-references will be provided to documentation and detailed examples that provide deeper insght into a particular topic.</p>
<p>As part of this workflow you will be introduced to various aspects such as</p>
<ol>
<li><p>Data wrangling in Julia</p>
</li>
<li><p>Exploratory analysis in Julia</p>
</li>
<li><p>Continous and discrete data non-linear mixed effects modeling in Pumas</p>
</li>
<li><p>Model comparison routines, post-processing, validation etc.</p>
</li>
</ol>
<h2>The study and design</h2>
<p>CTMNopain is a novel anti-inflammatory agent under preliminary investigation. A dose-ranging trial was conducted comparing placebo with 3 doses of CTMNopain &#40;5mg, 20mg and 80 mg QD&#41;.  The maximum tolerated dose is 160 mg per day. Plasma concentrations &#40;mg/L&#41; of the drug were measured at 0, 0.5, 1, 1.5, 2, 2.5, 3-8 hours.</p>
<p>Pain score &#40;0&#61;no pain, 1&#61;mild, 2&#61;moderate, 3&#61;severe&#41; were obtained at time points when plasma concentration was collected.  A pain score of 2 or more is considered as no pain relief.</p>
<p>The subjects can request for remedication if pain relief is not achieved after 2 hours post dose. Some subjects had remedication before 2 hours if they were not able to bear the pain. The time to remedication and the remedication status is available for subjects.</p>
<h2>The goal</h2>
<p>We are expected to provide input for an optimal dose/dosing regimen to be carried forward in future trials. Two datasets are provided below, that can be downloaded using the links below.</p>
<ol>
<li><p><a href="">pk_painscore.csv</a></p>
</li>
<li><p><a href="">pain_remedication.csv</a></p>
</li>
</ol>


<pre class='hljl'>
<span class='hljl-k'>using</span><span class='hljl-t'> </span><span class='hljl-n'>Random</span><span class='hljl-t'>
</span><span class='hljl-k'>using</span><span class='hljl-t'> </span><span class='hljl-n'>CSV</span><span class='hljl-t'>
</span><span class='hljl-k'>using</span><span class='hljl-t'> </span><span class='hljl-n'>Pumas</span><span class='hljl-t'>
</span><span class='hljl-k'>using</span><span class='hljl-t'> </span><span class='hljl-n'>PumasPlots</span><span class='hljl-t'>
</span><span class='hljl-k'>using</span><span class='hljl-t'> </span><span class='hljl-n'>Plots</span><span class='hljl-t'>
</span><span class='hljl-k'>using</span><span class='hljl-t'> </span><span class='hljl-n'>StatsPlots</span><span class='hljl-t'>
</span><span class='hljl-k'>using</span><span class='hljl-t'> </span><span class='hljl-n'>Pipe</span><span class='hljl-t'>
</span><span class='hljl-k'>using</span><span class='hljl-t'> </span><span class='hljl-n'>StatsBase</span><span class='hljl-t'>
</span><span class='hljl-k'>using</span><span class='hljl-t'> </span><span class='hljl-n'>PrettyTables</span>
</pre>



<h3>Data Wrangling</h3>
<p>We start by reading in the two dataset and making some quick summaries.</p>
<p>Note: As a general convention during this example, I will refer to dataframes by ending the name of the variable with <em>df</em> and the <code>Population</code> version of that dataframe will be without the <em>df</em> to avoid confusion.</p>


<pre class='hljl'>
<span class='hljl-n'>pkpain_df</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>DataFrame!</span><span class='hljl-p'>(</span><span class='hljl-n'>CSV</span><span class='hljl-oB'>.</span><span class='hljl-nf'>File</span><span class='hljl-p'>(</span><span class='hljl-s'>&quot;../../data/intro/pk_painscore.csv&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>missingstrings</span><span class='hljl-oB'>=</span><span class='hljl-p'>[</span><span class='hljl-s'>&quot;&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;NA&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;.&quot;</span><span class='hljl-p'>]))</span><span class='hljl-t'>
</span><span class='hljl-n'>remed_df</span><span class='hljl-t'>  </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>DataFrame!</span><span class='hljl-p'>(</span><span class='hljl-n'>CSV</span><span class='hljl-oB'>.</span><span class='hljl-nf'>File</span><span class='hljl-p'>(</span><span class='hljl-s'>&quot;../../data/intro/pain_remedication.csv&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>missingstrings</span><span class='hljl-oB'>=</span><span class='hljl-p'>[</span><span class='hljl-s'>&quot;&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;NA&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;.&quot;</span><span class='hljl-p'>]))</span>
</pre>



<p>Let&#39;s filter out the placebo data as we don&#39;t need that for the PK analysis.</p>


<pre class='hljl'>
<span class='hljl-n'>pkpain_noplb_df</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>filter</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-t'> </span><span class='hljl-oB'>-&gt;</span><span class='hljl-t'> </span><span class='hljl-oB'>!</span><span class='hljl-p'>(</span><span class='hljl-n'>occursin</span><span class='hljl-oB'>.</span><span class='hljl-p'>(</span><span class='hljl-s'>&quot;Placebo&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>x</span><span class='hljl-oB'>.</span><span class='hljl-n'>ARM</span><span class='hljl-p'>)),</span><span class='hljl-t'> </span><span class='hljl-n'>pkpain_df</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-nf'>pretty_table</span><span class='hljl-p'>(</span><span class='hljl-nf'>first</span><span class='hljl-p'>(</span><span class='hljl-n'>pkpain_noplb_df</span><span class='hljl-p'>,</span><span class='hljl-ni'>10</span><span class='hljl-p'>),</span><span class='hljl-t'> </span><span class='hljl-n'>backend</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:html</span><span class='hljl-p'>;</span><span class='hljl-t'>
            </span><span class='hljl-n'>formatters</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>ft_round</span><span class='hljl-p'>(</span><span class='hljl-ni'>3</span><span class='hljl-p'>))</span>
</pre>



<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<style>
table, td, th {
    border-collapse: collapse;
    font-family: sans-serif;
}

td, th {
    border-bottom: 0;
    padding: 4px
}

tr:nth-child(odd) {
    background: #eee;
}

tr:nth-child(even) {
    background: #fff;
}

tr.header {
    background: navy !important;
    color: white;
    font-weight: bold;
}

tr.subheader {
    background: lightgray !important;
    color: black;
}

tr.headerLastRow {
    border-bottom: 2px solid black;
}

th.rowNumber, td.rowNumber {
    text-align: right;
}

</style>
<body>
<table>
<tr class = header>
<th style = "text-align: right; ">ARM</th>
<th style = "text-align: right; ">ID</th>
<th style = "text-align: right; ">TIME</th>
<th style = "text-align: right; ">CONC</th>
<th style = "text-align: right; ">PAINRELIEF</th>
<th style = "text-align: right; ">DOSE</th>
</tr>
<tr class = "subheader headerLastRow">
<th style = "text-align: right; ">String</th>
<th style = "text-align: right; ">Int64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Int64</th>
<th style = "text-align: right; ">Int64</th>
</tr>
<tr>
<td style = "text-align: right; ">A20_0_at2h</td>
<td style = "text-align: right; ">1.0</td>
<td style = "text-align: right; ">0.0</td>
<td style = "text-align: right; ">0.0</td>
<td style = "text-align: right; ">0.0</td>
<td style = "text-align: right; ">20.0</td>
</tr>
<tr>
<td style = "text-align: right; ">A20_0_at2h</td>
<td style = "text-align: right; ">1.0</td>
<td style = "text-align: right; ">0.5</td>
<td style = "text-align: right; ">1.156</td>
<td style = "text-align: right; ">1.0</td>
<td style = "text-align: right; ">20.0</td>
</tr>
<tr>
<td style = "text-align: right; ">A20_0_at2h</td>
<td style = "text-align: right; ">1.0</td>
<td style = "text-align: right; ">1.0</td>
<td style = "text-align: right; ">1.372</td>
<td style = "text-align: right; ">1.0</td>
<td style = "text-align: right; ">20.0</td>
</tr>
<tr>
<td style = "text-align: right; ">A20_0_at2h</td>
<td style = "text-align: right; ">1.0</td>
<td style = "text-align: right; ">1.5</td>
<td style = "text-align: right; ">1.301</td>
<td style = "text-align: right; ">1.0</td>
<td style = "text-align: right; ">20.0</td>
</tr>
<tr>
<td style = "text-align: right; ">A20_0_at2h</td>
<td style = "text-align: right; ">1.0</td>
<td style = "text-align: right; ">2.0</td>
<td style = "text-align: right; ">1.192</td>
<td style = "text-align: right; ">1.0</td>
<td style = "text-align: right; ">20.0</td>
</tr>
<tr>
<td style = "text-align: right; ">A20_0_at2h</td>
<td style = "text-align: right; ">1.0</td>
<td style = "text-align: right; ">2.5</td>
<td style = "text-align: right; ">1.136</td>
<td style = "text-align: right; ">1.0</td>
<td style = "text-align: right; ">20.0</td>
</tr>
<tr>
<td style = "text-align: right; ">A20_0_at2h</td>
<td style = "text-align: right; ">1.0</td>
<td style = "text-align: right; ">3.0</td>
<td style = "text-align: right; ">0.873</td>
<td style = "text-align: right; ">1.0</td>
<td style = "text-align: right; ">20.0</td>
</tr>
<tr>
<td style = "text-align: right; ">A20_0_at2h</td>
<td style = "text-align: right; ">1.0</td>
<td style = "text-align: right; ">4.0</td>
<td style = "text-align: right; ">0.74</td>
<td style = "text-align: right; ">1.0</td>
<td style = "text-align: right; ">20.0</td>
</tr>
<tr>
<td style = "text-align: right; ">A20_0_at2h</td>
<td style = "text-align: right; ">1.0</td>
<td style = "text-align: right; ">5.0</td>
<td style = "text-align: right; ">0.6</td>
<td style = "text-align: right; ">0.0</td>
<td style = "text-align: right; ">20.0</td>
</tr>
<tr>
<td style = "text-align: right; ">A20_0_at2h</td>
<td style = "text-align: right; ">1.0</td>
<td style = "text-align: right; ">6.0</td>
<td style = "text-align: right; ">0.426</td>
<td style = "text-align: right; ">1.0</td>
<td style = "text-align: right; ">20.0</td>
</tr>
</table>
</body>
</html>


<p>do some data wrangling and plotting here</p>
<h3>Non-compartmental analysis</h3>
<p>Let&#39;s begin by peforming a quick NCA of the concentration time profiles and view the exposure changes across doses. The input data specicfication for NCA analysis &#40;&#41; requires the presence of a <code>route</code> column and an amount column that specifies the dose. So, let&#39;s add that in.</p>


<pre class='hljl'>
<span class='hljl-cs'>#adding route variable</span><span class='hljl-t'>
</span><span class='hljl-n'>pkpain_noplb_df</span><span class='hljl-p'>[</span><span class='hljl-oB'>!</span><span class='hljl-p'>,</span><span class='hljl-oB'>:</span><span class='hljl-n'>route</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-oB'>.=</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;ev&quot;</span><span class='hljl-t'>
</span><span class='hljl-cs'># creating an `amt` column</span><span class='hljl-t'>
</span><span class='hljl-n'>pkpain_noplb_df</span><span class='hljl-p'>[</span><span class='hljl-oB'>!</span><span class='hljl-p'>,</span><span class='hljl-oB'>:</span><span class='hljl-n'>amt</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-oB'>.=</span><span class='hljl-t'> </span><span class='hljl-n'>ifelse</span><span class='hljl-oB'>.</span><span class='hljl-p'>(</span><span class='hljl-n'>pkpain_noplb_df</span><span class='hljl-oB'>.</span><span class='hljl-n'>TIME</span><span class='hljl-t'> </span><span class='hljl-oB'>.==</span><span class='hljl-t'> </span><span class='hljl-ni'>0</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>pkpain_noplb_df</span><span class='hljl-oB'>.</span><span class='hljl-n'>DOSE</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>missing</span><span class='hljl-p'>)</span>
</pre>



<p>Now, we map the data variables to the <code>read_nca</code> function that prepares the data for NCA analysis.</p>


<pre class='hljl'>
<span class='hljl-n'>pkpain_nca</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>read_nca</span><span class='hljl-p'>(</span><span class='hljl-n'>pkpain_noplb_df</span><span class='hljl-p'>,</span><span class='hljl-t'>
                      </span><span class='hljl-n'>id</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:ID</span><span class='hljl-p'>,</span><span class='hljl-t'>
                      </span><span class='hljl-n'>time</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:TIME</span><span class='hljl-p'>,</span><span class='hljl-t'>
                      </span><span class='hljl-n'>amt</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:amt</span><span class='hljl-p'>,</span><span class='hljl-t'>
                      </span><span class='hljl-n'>conc</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:CONC</span><span class='hljl-p'>,</span><span class='hljl-t'>
                      </span><span class='hljl-n'>group</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>[</span><span class='hljl-sc'>:DOSE</span><span class='hljl-p'>],</span><span class='hljl-t'>
                      </span><span class='hljl-n'>route</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:route</span><span class='hljl-p'>)</span>
</pre>



<p>A full <code>NCAReport</code> is now obtained for completeness purposes, but later we will only extract a couple of key metrics of interest.</p>


<pre class='hljl'>
<span class='hljl-n'>pk_nca_report</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>NCAReport</span><span class='hljl-p'>(</span><span class='hljl-n'>pkpain_nca</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>sigdig</span><span class='hljl-oB'>=</span><span class='hljl-ni'>3</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-nf'>pretty_table</span><span class='hljl-p'>(</span><span class='hljl-nf'>first</span><span class='hljl-p'>(</span><span class='hljl-n'>pk_nca_report</span><span class='hljl-p'>,</span><span class='hljl-ni'>10</span><span class='hljl-p'>),</span><span class='hljl-t'> </span><span class='hljl-n'>backend</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:html</span><span class='hljl-p'>;</span><span class='hljl-t'>
            </span><span class='hljl-n'>formatters</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>ft_round</span><span class='hljl-p'>(</span><span class='hljl-ni'>3</span><span class='hljl-p'>))</span>
</pre>



<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<style>
table, td, th {
    border-collapse: collapse;
    font-family: sans-serif;
}

td, th {
    border-bottom: 0;
    padding: 4px
}

tr:nth-child(odd) {
    background: #eee;
}

tr:nth-child(even) {
    background: #fff;
}

tr.header {
    background: navy !important;
    color: white;
    font-weight: bold;
}

tr.subheader {
    background: lightgray !important;
    color: black;
}

tr.headerLastRow {
    border-bottom: 2px solid black;
}

th.rowNumber, td.rowNumber {
    text-align: right;
}

</style>
<body>
<table>
<tr class = header>
<th style = "text-align: right; ">id</th>
<th style = "text-align: right; ">DOSE</th>
<th style = "text-align: right; ">doseamt</th>
<th style = "text-align: right; ">tlag</th>
<th style = "text-align: right; ">tmax</th>
<th style = "text-align: right; ">cmax</th>
<th style = "text-align: right; ">tlast</th>
<th style = "text-align: right; ">clast</th>
<th style = "text-align: right; ">clast_pred</th>
<th style = "text-align: right; ">auclast</th>
<th style = "text-align: right; ">kel</th>
<th style = "text-align: right; ">half_life</th>
<th style = "text-align: right; ">aucinf_obs</th>
<th style = "text-align: right; ">aucinf_pred</th>
<th style = "text-align: right; ">vz_f_obs</th>
<th style = "text-align: right; ">cl_f_obs</th>
<th style = "text-align: right; ">vz_f_pred</th>
<th style = "text-align: right; ">cl_f_pred</th>
<th style = "text-align: right; ">n_samples</th>
<th style = "text-align: right; ">cmax_dn</th>
<th style = "text-align: right; ">auclast_dn</th>
<th style = "text-align: right; ">aucinf_dn_obs</th>
<th style = "text-align: right; ">auc_extrap_obs</th>
<th style = "text-align: right; ">aucinf_dn_pred</th>
<th style = "text-align: right; ">auc_extrap_pred</th>
<th style = "text-align: right; ">aumclast</th>
<th style = "text-align: right; ">aumcinf_obs</th>
<th style = "text-align: right; ">aumc_extrap_obs</th>
<th style = "text-align: right; ">aumcinf_pred</th>
<th style = "text-align: right; ">aumc_extrap_pred</th>
<th style = "text-align: right; ">n_samples_kel</th>
<th style = "text-align: right; ">rsq_kel</th>
<th style = "text-align: right; ">rsq_adj_kel</th>
<th style = "text-align: right; ">corr_kel</th>
<th style = "text-align: right; ">intercept_kel</th>
<th style = "text-align: right; ">kel_t_low</th>
<th style = "text-align: right; ">kel_t_high</th>
<th style = "text-align: right; ">span</th>
<th style = "text-align: right; ">route</th>
<th style = "text-align: right; ">run_status</th>
</tr>
<tr class = "subheader headerLastRow">
<th style = "text-align: right; ">Int64</th>
<th style = "text-align: right; ">Int64</th>
<th style = "text-align: right; ">Int64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Int64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Int64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">String</th>
<th style = "text-align: right; ">Symbol</th>
</tr>
<tr>
<td style = "text-align: right; ">6.0</td>
<td style = "text-align: right; ">5.0</td>
<td style = "text-align: right; ">5.0</td>
<td style = "text-align: right; ">0.0</td>
<td style = "text-align: right; ">1.0</td>
<td style = "text-align: right; ">0.316</td>
<td style = "text-align: right; ">8.0</td>
<td style = "text-align: right; ">0.111</td>
<td style = "text-align: right; ">0.107</td>
<td style = "text-align: right; ">1.557</td>
<td style = "text-align: right; ">0.151</td>
<td style = "text-align: right; ">4.595</td>
<td style = "text-align: right; ">2.29</td>
<td style = "text-align: right; ">2.266</td>
<td style = "text-align: right; ">14.474</td>
<td style = "text-align: right; ">2.184</td>
<td style = "text-align: right; ">14.624</td>
<td style = "text-align: right; ">2.206</td>
<td style = "text-align: right; ">12.0</td>
<td style = "text-align: right; ">0.063</td>
<td style = "text-align: right; ">0.311</td>
<td style = "text-align: right; ">0.458</td>
<td style = "text-align: right; ">32.022</td>
<td style = "text-align: right; ">0.453</td>
<td style = "text-align: right; ">31.318</td>
<td style = "text-align: right; ">5.276</td>
<td style = "text-align: right; ">16.002</td>
<td style = "text-align: right; ">67.028</td>
<td style = "text-align: right; ">15.659</td>
<td style = "text-align: right; ">66.306</td>
<td style = "text-align: right; ">6.0</td>
<td style = "text-align: right; ">0.983</td>
<td style = "text-align: right; ">0.979</td>
<td style = "text-align: right; ">0.991</td>
<td style = "text-align: right; ">-1.027</td>
<td style = "text-align: right; ">3.0</td>
<td style = "text-align: right; ">8.0</td>
<td style = "text-align: right; ">1.088</td>
<td style = "text-align: right; ">EV</td>
<td style = "text-align: right; ">Success</td>
</tr>
<tr>
<td style = "text-align: right; ">8.0</td>
<td style = "text-align: right; ">5.0</td>
<td style = "text-align: right; ">5.0</td>
<td style = "text-align: right; ">0.0</td>
<td style = "text-align: right; ">0.5</td>
<td style = "text-align: right; ">0.336</td>
<td style = "text-align: right; ">8.0</td>
<td style = "text-align: right; ">0.096</td>
<td style = "text-align: right; ">0.096</td>
<td style = "text-align: right; ">1.498</td>
<td style = "text-align: right; ">0.145</td>
<td style = "text-align: right; ">4.768</td>
<td style = "text-align: right; ">2.16</td>
<td style = "text-align: right; ">2.159</td>
<td style = "text-align: right; ">15.922</td>
<td style = "text-align: right; ">2.315</td>
<td style = "text-align: right; ">15.93</td>
<td style = "text-align: right; ">2.316</td>
<td style = "text-align: right; ">12.0</td>
<td style = "text-align: right; ">0.067</td>
<td style = "text-align: right; ">0.3</td>
<td style = "text-align: right; ">0.432</td>
<td style = "text-align: right; ">30.642</td>
<td style = "text-align: right; ">0.432</td>
<td style = "text-align: right; ">30.61</td>
<td style = "text-align: right; ">4.93</td>
<td style = "text-align: right; ">14.778</td>
<td style = "text-align: right; ">66.639</td>
<td style = "text-align: right; ">14.763</td>
<td style = "text-align: right; ">66.605</td>
<td style = "text-align: right; ">3.0</td>
<td style = "text-align: right; ">1.0</td>
<td style = "text-align: right; ">0.999</td>
<td style = "text-align: right; ">1.0</td>
<td style = "text-align: right; ">-1.18</td>
<td style = "text-align: right; ">6.0</td>
<td style = "text-align: right; ">8.0</td>
<td style = "text-align: right; ">0.419</td>
<td style = "text-align: right; ">EV</td>
<td style = "text-align: right; ">Success</td>
</tr>
<tr>
<td style = "text-align: right; ">9.0</td>
<td style = "text-align: right; ">5.0</td>
<td style = "text-align: right; ">5.0</td>
<td style = "text-align: right; ">0.0</td>
<td style = "text-align: right; ">0.5</td>
<td style = "text-align: right; ">0.539</td>
<td style = "text-align: right; ">8.0</td>
<td style = "text-align: right; ">0.043</td>
<td style = "text-align: right; ">0.039</td>
<td style = "text-align: right; ">1.37</td>
<td style = "text-align: right; ">0.311</td>
<td style = "text-align: right; ">2.226</td>
<td style = "text-align: right; ">1.508</td>
<td style = "text-align: right; ">1.494</td>
<td style = "text-align: right; ">10.648</td>
<td style = "text-align: right; ">3.316</td>
<td style = "text-align: right; ">10.749</td>
<td style = "text-align: right; ">3.347</td>
<td style = "text-align: right; ">12.0</td>
<td style = "text-align: right; ">0.108</td>
<td style = "text-align: right; ">0.274</td>
<td style = "text-align: right; ">0.302</td>
<td style = "text-align: right; ">9.175</td>
<td style = "text-align: right; ">0.299</td>
<td style = "text-align: right; ">8.32</td>
<td style = "text-align: right; ">3.431</td>
<td style = "text-align: right; ">4.982</td>
<td style = "text-align: right; ">31.135</td>
<td style = "text-align: right; ">4.824</td>
<td style = "text-align: right; ">28.884</td>
<td style = "text-align: right; ">9.0</td>
<td style = "text-align: right; ">0.993</td>
<td style = "text-align: right; ">0.992</td>
<td style = "text-align: right; ">0.997</td>
<td style = "text-align: right; ">-0.761</td>
<td style = "text-align: right; ">1.5</td>
<td style = "text-align: right; ">8.0</td>
<td style = "text-align: right; ">2.92</td>
<td style = "text-align: right; ">EV</td>
<td style = "text-align: right; ">Success</td>
</tr>
<tr>
<td style = "text-align: right; ">12.0</td>
<td style = "text-align: right; ">5.0</td>
<td style = "text-align: right; ">5.0</td>
<td style = "text-align: right; ">0.0</td>
<td style = "text-align: right; ">1.0</td>
<td style = "text-align: right; ">0.215</td>
<td style = "text-align: right; ">8.0</td>
<td style = "text-align: right; ">0.066</td>
<td style = "text-align: right; ">0.065</td>
<td style = "text-align: right; ">1.063</td>
<td style = "text-align: right; ">0.184</td>
<td style = "text-align: right; ">3.759</td>
<td style = "text-align: right; ">1.424</td>
<td style = "text-align: right; ">1.418</td>
<td style = "text-align: right; ">19.039</td>
<td style = "text-align: right; ">3.511</td>
<td style = "text-align: right; ">19.125</td>
<td style = "text-align: right; ">3.527</td>
<td style = "text-align: right; ">12.0</td>
<td style = "text-align: right; ">0.043</td>
<td style = "text-align: right; ">0.213</td>
<td style = "text-align: right; ">0.285</td>
<td style = "text-align: right; ">25.32</td>
<td style = "text-align: right; ">0.284</td>
<td style = "text-align: right; ">24.981</td>
<td style = "text-align: right; ">3.584</td>
<td style = "text-align: right; ">8.424</td>
<td style = "text-align: right; ">57.453</td>
<td style = "text-align: right; ">8.337</td>
<td style = "text-align: right; ">57.012</td>
<td style = "text-align: right; ">9.0</td>
<td style = "text-align: right; ">0.991</td>
<td style = "text-align: right; ">0.989</td>
<td style = "text-align: right; ">0.995</td>
<td style = "text-align: right; ">-1.253</td>
<td style = "text-align: right; ">1.5</td>
<td style = "text-align: right; ">8.0</td>
<td style = "text-align: right; ">1.729</td>
<td style = "text-align: right; ">EV</td>
<td style = "text-align: right; ">Success</td>
</tr>
<tr>
<td style = "text-align: right; ">17.0</td>
<td style = "text-align: right; ">5.0</td>
<td style = "text-align: right; ">5.0</td>
<td style = "text-align: right; ">0.0</td>
<td style = "text-align: right; ">1.0</td>
<td style = "text-align: right; ">0.19</td>
<td style = "text-align: right; ">8.0</td>
<td style = "text-align: right; ">0.056</td>
<td style = "text-align: right; ">0.055</td>
<td style = "text-align: right; ">0.948</td>
<td style = "text-align: right; ">0.242</td>
<td style = "text-align: right; ">2.863</td>
<td style = "text-align: right; ">1.179</td>
<td style = "text-align: right; ">1.177</td>
<td style = "text-align: right; ">17.517</td>
<td style = "text-align: right; ">4.241</td>
<td style = "text-align: right; ">17.552</td>
<td style = "text-align: right; ">4.25</td>
<td style = "text-align: right; ">12.0</td>
<td style = "text-align: right; ">0.038</td>
<td style = "text-align: right; ">0.19</td>
<td style = "text-align: right; ">0.236</td>
<td style = "text-align: right; ">19.579</td>
<td style = "text-align: right; ">0.235</td>
<td style = "text-align: right; ">19.416</td>
<td style = "text-align: right; ">3.226</td>
<td style = "text-align: right; ">6.025</td>
<td style = "text-align: right; ">46.466</td>
<td style = "text-align: right; ">5.997</td>
<td style = "text-align: right; ">46.209</td>
<td style = "text-align: right; ">3.0</td>
<td style = "text-align: right; ">0.995</td>
<td style = "text-align: right; ">0.989</td>
<td style = "text-align: right; ">0.997</td>
<td style = "text-align: right; ">-0.958</td>
<td style = "text-align: right; ">6.0</td>
<td style = "text-align: right; ">8.0</td>
<td style = "text-align: right; ">0.699</td>
<td style = "text-align: right; ">EV</td>
<td style = "text-align: right; ">Success</td>
</tr>
<tr>
<td style = "text-align: right; ">24.0</td>
<td style = "text-align: right; ">5.0</td>
<td style = "text-align: right; ">5.0</td>
<td style = "text-align: right; ">0.0</td>
<td style = "text-align: right; ">1.0</td>
<td style = "text-align: right; ">0.264</td>
<td style = "text-align: right; ">8.0</td>
<td style = "text-align: right; ">0.025</td>
<td style = "text-align: right; ">0.024</td>
<td style = "text-align: right; ">0.908</td>
<td style = "text-align: right; ">0.349</td>
<td style = "text-align: right; ">1.986</td>
<td style = "text-align: right; ">0.979</td>
<td style = "text-align: right; ">0.976</td>
<td style = "text-align: right; ">14.634</td>
<td style = "text-align: right; ">5.109</td>
<td style = "text-align: right; ">14.677</td>
<td style = "text-align: right; ">5.124</td>
<td style = "text-align: right; ">12.0</td>
<td style = "text-align: right; ">0.053</td>
<td style = "text-align: right; ">0.182</td>
<td style = "text-align: right; ">0.196</td>
<td style = "text-align: right; ">7.211</td>
<td style = "text-align: right; ">0.195</td>
<td style = "text-align: right; ">6.941</td>
<td style = "text-align: right; ">2.431</td>
<td style = "text-align: right; ">3.198</td>
<td style = "text-align: right; ">23.978</td>
<td style = "text-align: right; ">3.167</td>
<td style = "text-align: right; ">23.236</td>
<td style = "text-align: right; ">7.0</td>
<td style = "text-align: right; ">0.995</td>
<td style = "text-align: right; ">0.994</td>
<td style = "text-align: right; ">0.998</td>
<td style = "text-align: right; ">-0.952</td>
<td style = "text-align: right; ">2.5</td>
<td style = "text-align: right; ">8.0</td>
<td style = "text-align: right; ">2.77</td>
<td style = "text-align: right; ">EV</td>
<td style = "text-align: right; ">Success</td>
</tr>
<tr>
<td style = "text-align: right; ">29.0</td>
<td style = "text-align: right; ">5.0</td>
<td style = "text-align: right; ">5.0</td>
<td style = "text-align: right; ">0.0</td>
<td style = "text-align: right; ">0.5</td>
<td style = "text-align: right; ">0.353</td>
<td style = "text-align: right; ">8.0</td>
<td style = "text-align: right; ">0.038</td>
<td style = "text-align: right; ">0.037</td>
<td style = "text-align: right; ">1.171</td>
<td style = "text-align: right; ">0.308</td>
<td style = "text-align: right; ">2.248</td>
<td style = "text-align: right; ">1.293</td>
<td style = "text-align: right; ">1.29</td>
<td style = "text-align: right; ">12.54</td>
<td style = "text-align: right; ">3.867</td>
<td style = "text-align: right; ">12.571</td>
<td style = "text-align: right; ">3.877</td>
<td style = "text-align: right; ">12.0</td>
<td style = "text-align: right; ">0.071</td>
<td style = "text-align: right; ">0.234</td>
<td style = "text-align: right; ">0.259</td>
<td style = "text-align: right; ">9.451</td>
<td style = "text-align: right; ">0.258</td>
<td style = "text-align: right; ">9.225</td>
<td style = "text-align: right; ">3.179</td>
<td style = "text-align: right; ">4.553</td>
<td style = "text-align: right; ">30.177</td>
<td style = "text-align: right; ">4.516</td>
<td style = "text-align: right; ">29.616</td>
<td style = "text-align: right; ">10.0</td>
<td style = "text-align: right; ">0.992</td>
<td style = "text-align: right; ">0.991</td>
<td style = "text-align: right; ">0.996</td>
<td style = "text-align: right; ">-0.838</td>
<td style = "text-align: right; ">1.0</td>
<td style = "text-align: right; ">8.0</td>
<td style = "text-align: right; ">3.114</td>
<td style = "text-align: right; ">EV</td>
<td style = "text-align: right; ">Success</td>
</tr>
<tr>
<td style = "text-align: right; ">32.0</td>
<td style = "text-align: right; ">5.0</td>
<td style = "text-align: right; ">5.0</td>
<td style = "text-align: right; ">0.0</td>
<td style = "text-align: right; ">0.5</td>
<td style = "text-align: right; ">0.311</td>
<td style = "text-align: right; ">8.0</td>
<td style = "text-align: right; ">0.151</td>
<td style = "text-align: right; ">0.143</td>
<td style = "text-align: right; ">1.592</td>
<td style = "text-align: right; ">0.084</td>
<td style = "text-align: right; ">8.287</td>
<td style = "text-align: right; ">3.399</td>
<td style = "text-align: right; ">3.305</td>
<td style = "text-align: right; ">17.584</td>
<td style = "text-align: right; ">1.471</td>
<td style = "text-align: right; ">18.086</td>
<td style = "text-align: right; ">1.513</td>
<td style = "text-align: right; ">12.0</td>
<td style = "text-align: right; ">0.062</td>
<td style = "text-align: right; ">0.318</td>
<td style = "text-align: right; ">0.68</td>
<td style = "text-align: right; ">53.17</td>
<td style = "text-align: right; ">0.661</td>
<td style = "text-align: right; ">51.834</td>
<td style = "text-align: right; ">5.784</td>
<td style = "text-align: right; ">41.853</td>
<td style = "text-align: right; ">86.181</td>
<td style = "text-align: right; ">39.971</td>
<td style = "text-align: right; ">85.53</td>
<td style = "text-align: right; ">9.0</td>
<td style = "text-align: right; ">0.968</td>
<td style = "text-align: right; ">0.963</td>
<td style = "text-align: right; ">0.984</td>
<td style = "text-align: right; ">-1.274</td>
<td style = "text-align: right; ">1.5</td>
<td style = "text-align: right; ">8.0</td>
<td style = "text-align: right; ">0.784</td>
<td style = "text-align: right; ">EV</td>
<td style = "text-align: right; ">Success</td>
</tr>
<tr>
<td style = "text-align: right; ">38.0</td>
<td style = "text-align: right; ">5.0</td>
<td style = "text-align: right; ">5.0</td>
<td style = "text-align: right; ">0.0</td>
<td style = "text-align: right; ">0.5</td>
<td style = "text-align: right; ">0.295</td>
<td style = "text-align: right; ">8.0</td>
<td style = "text-align: right; ">0.077</td>
<td style = "text-align: right; ">0.076</td>
<td style = "text-align: right; ">1.168</td>
<td style = "text-align: right; ">0.132</td>
<td style = "text-align: right; ">5.235</td>
<td style = "text-align: right; ">1.751</td>
<td style = "text-align: right; ">1.741</td>
<td style = "text-align: right; ">21.57</td>
<td style = "text-align: right; ">2.856</td>
<td style = "text-align: right; ">21.689</td>
<td style = "text-align: right; ">2.872</td>
<td style = "text-align: right; ">12.0</td>
<td style = "text-align: right; ">0.059</td>
<td style = "text-align: right; ">0.234</td>
<td style = "text-align: right; ">0.35</td>
<td style = "text-align: right; ">33.286</td>
<td style = "text-align: right; ">0.348</td>
<td style = "text-align: right; ">32.916</td>
<td style = "text-align: right; ">3.721</td>
<td style = "text-align: right; ">12.784</td>
<td style = "text-align: right; ">70.89</td>
<td style = "text-align: right; ">12.634</td>
<td style = "text-align: right; ">70.544</td>
<td style = "text-align: right; ">6.0</td>
<td style = "text-align: right; ">0.996</td>
<td style = "text-align: right; ">0.995</td>
<td style = "text-align: right; ">0.998</td>
<td style = "text-align: right; ">-1.519</td>
<td style = "text-align: right; ">3.0</td>
<td style = "text-align: right; ">8.0</td>
<td style = "text-align: right; ">0.955</td>
<td style = "text-align: right; ">EV</td>
<td style = "text-align: right; ">Success</td>
</tr>
<tr>
<td style = "text-align: right; ">40.0</td>
<td style = "text-align: right; ">5.0</td>
<td style = "text-align: right; ">5.0</td>
<td style = "text-align: right; ">0.0</td>
<td style = "text-align: right; ">0.5</td>
<td style = "text-align: right; ">0.449</td>
<td style = "text-align: right; ">8.0</td>
<td style = "text-align: right; ">0.065</td>
<td style = "text-align: right; ">0.065</td>
<td style = "text-align: right; ">1.384</td>
<td style = "text-align: right; ">0.185</td>
<td style = "text-align: right; ">3.738</td>
<td style = "text-align: right; ">1.734</td>
<td style = "text-align: right; ">1.732</td>
<td style = "text-align: right; ">15.546</td>
<td style = "text-align: right; ">2.883</td>
<td style = "text-align: right; ">15.567</td>
<td style = "text-align: right; ">2.887</td>
<td style = "text-align: right; ">12.0</td>
<td style = "text-align: right; ">0.09</td>
<td style = "text-align: right; ">0.277</td>
<td style = "text-align: right; ">0.347</td>
<td style = "text-align: right; ">20.214</td>
<td style = "text-align: right; ">0.346</td>
<td style = "text-align: right; ">20.108</td>
<td style = "text-align: right; ">3.93</td>
<td style = "text-align: right; ">8.625</td>
<td style = "text-align: right; ">54.434</td>
<td style = "text-align: right; ">8.594</td>
<td style = "text-align: right; ">54.271</td>
<td style = "text-align: right; ">5.0</td>
<td style = "text-align: right; ">0.998</td>
<td style = "text-align: right; ">0.997</td>
<td style = "text-align: right; ">0.999</td>
<td style = "text-align: right; ">-1.256</td>
<td style = "text-align: right; ">4.0</td>
<td style = "text-align: right; ">8.0</td>
<td style = "text-align: right; ">1.07</td>
<td style = "text-align: right; ">EV</td>
<td style = "text-align: right; ">Success</td>
</tr>
</table>
</body>
</html>


<p>As CTMNopain&#39;s effect maybe mainly related to maximum concentration &#40;<code>cmax</code>&#41; or area under the curve &#40;<code>auc</code>&#41;, we present some summary statistics.</p>


<pre class='hljl'>
<span class='hljl-n'>auc_cmax</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>select</span><span class='hljl-p'>(</span><span class='hljl-n'>pk_nca_report</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-p'>[</span><span class='hljl-sc'>:id</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>:DOSE</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>:cmax</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>:aucinf_obs</span><span class='hljl-p'>])</span><span class='hljl-t'>
</span><span class='hljl-cs'>#pivot data to allow easy computation</span><span class='hljl-t'>
</span><span class='hljl-n'>auc_cmax_stacked</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>stack</span><span class='hljl-p'>(</span><span class='hljl-n'>auc_cmax</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-p'>[</span><span class='hljl-sc'>:cmax</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>:aucinf_obs</span><span class='hljl-p'>],</span><span class='hljl-t'> </span><span class='hljl-p'>[</span><span class='hljl-sc'>:id</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>:DOSE</span><span class='hljl-p'>])</span><span class='hljl-t'>
</span><span class='hljl-n'>auc_cmax_summary</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>combine</span><span class='hljl-p'>(</span><span class='hljl-nf'>groupby</span><span class='hljl-p'>(</span><span class='hljl-n'>auc_cmax_stacked</span><span class='hljl-p'>,[</span><span class='hljl-sc'>:DOSE</span><span class='hljl-p'>,</span><span class='hljl-oB'>:</span><span class='hljl-n'>variable</span><span class='hljl-p'>]),</span><span class='hljl-t'>
                           </span><span class='hljl-p'>[</span><span class='hljl-n'>col</span><span class='hljl-t'> </span><span class='hljl-oB'>=&gt;</span><span class='hljl-t'> </span><span class='hljl-n'>fun</span><span class='hljl-t'> </span><span class='hljl-k'>for</span><span class='hljl-t'> </span><span class='hljl-n'>col</span><span class='hljl-t'> </span><span class='hljl-kp'>in</span><span class='hljl-t'> </span><span class='hljl-p'>[</span><span class='hljl-sc'>:value</span><span class='hljl-p'>]</span><span class='hljl-t'>
                           </span><span class='hljl-k'>for</span><span class='hljl-t'> </span><span class='hljl-n'>fun</span><span class='hljl-t'> </span><span class='hljl-kp'>in</span><span class='hljl-t'> </span><span class='hljl-p'>[</span><span class='hljl-n'>mean</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>median</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>geomean</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>std</span><span class='hljl-p'>]])</span><span class='hljl-t'>

</span><span class='hljl-nf'>pretty_table</span><span class='hljl-p'>(</span><span class='hljl-n'>auc_cmax_summary</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>backend</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:html</span><span class='hljl-p'>;</span><span class='hljl-t'>
            </span><span class='hljl-n'>formatters</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>ft_round</span><span class='hljl-p'>(</span><span class='hljl-ni'>3</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-p'>[</span><span class='hljl-ni'>3</span><span class='hljl-p'>,</span><span class='hljl-ni'>4</span><span class='hljl-p'>,</span><span class='hljl-ni'>5</span><span class='hljl-p'>,</span><span class='hljl-ni'>6</span><span class='hljl-p'>]))</span>
</pre>



<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<style>
table, td, th {
    border-collapse: collapse;
    font-family: sans-serif;
}

td, th {
    border-bottom: 0;
    padding: 4px
}

tr:nth-child(odd) {
    background: #eee;
}

tr:nth-child(even) {
    background: #fff;
}

tr.header {
    background: navy !important;
    color: white;
    font-weight: bold;
}

tr.subheader {
    background: lightgray !important;
    color: black;
}

tr.headerLastRow {
    border-bottom: 2px solid black;
}

th.rowNumber, td.rowNumber {
    text-align: right;
}

</style>
<body>
<table>
<tr class = header>
<th style = "text-align: right; ">DOSE</th>
<th style = "text-align: right; ">variable</th>
<th style = "text-align: right; ">value_mean</th>
<th style = "text-align: right; ">value_median</th>
<th style = "text-align: right; ">value_geomean</th>
<th style = "text-align: right; ">value_std</th>
</tr>
<tr class = "subheader headerLastRow">
<th style = "text-align: right; ">Int64</th>
<th style = "text-align: right; ">CategoricalValue{String,UInt32}</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
</tr>
<tr>
<td style = "text-align: right; ">5</td>
<td style = "text-align: right; ">cmax</td>
<td style = "text-align: right; ">0.356</td>
<td style = "text-align: right; ">0.353</td>
<td style = "text-align: right; ">0.345</td>
<td style = "text-align: right; ">0.088</td>
</tr>
<tr>
<td style = "text-align: right; ">20</td>
<td style = "text-align: right; ">cmax</td>
<td style = "text-align: right; ">1.474</td>
<td style = "text-align: right; ">1.436</td>
<td style = "text-align: right; ">1.434</td>
<td style = "text-align: right; ">0.362</td>
</tr>
<tr>
<td style = "text-align: right; ">80</td>
<td style = "text-align: right; ">cmax</td>
<td style = "text-align: right; ">5.787</td>
<td style = "text-align: right; ">5.583</td>
<td style = "text-align: right; ">5.641</td>
<td style = "text-align: right; ">1.32</td>
</tr>
<tr>
<td style = "text-align: right; ">5</td>
<td style = "text-align: right; ">aucinf_obs</td>
<td style = "text-align: right; ">1.598</td>
<td style = "text-align: right; ">1.532</td>
<td style = "text-align: right; ">1.534</td>
<td style = "text-align: right; ">0.49</td>
</tr>
<tr>
<td style = "text-align: right; ">20</td>
<td style = "text-align: right; ">aucinf_obs</td>
<td style = "text-align: right; ">6.376</td>
<td style = "text-align: right; ">6.459</td>
<td style = "text-align: right; ">6.02</td>
<td style = "text-align: right; ">2.223</td>
</tr>
<tr>
<td style = "text-align: right; ">80</td>
<td style = "text-align: right; ">aucinf_obs</td>
<td style = "text-align: right; ">29.502</td>
<td style = "text-align: right; ">28.016</td>
<td style = "text-align: right; ">28.297</td>
<td style = "text-align: right; ">8.696</td>
</tr>
</table>
</body>
</html>




<pre class='hljl'>
<span class='hljl-cs'>#TODO unable to get ordered x-axis</span><span class='hljl-t'>
</span><span class='hljl-n'>auc_cmax</span><span class='hljl-p'>[</span><span class='hljl-oB'>!</span><span class='hljl-p'>,</span><span class='hljl-oB'>:</span><span class='hljl-n'>Dose</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-oB'>.=</span><span class='hljl-t'> </span><span class='hljl-nf'>CategoricalArray</span><span class='hljl-p'>(</span><span class='hljl-n'>auc_cmax</span><span class='hljl-oB'>.</span><span class='hljl-n'>DOSE</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-cs'>#levels!(auc_cmax[!,:Dose], [&quot;5&quot;, &quot;20&quot;, &quot;80&quot;])</span><span class='hljl-t'>
</span><span class='hljl-nd'>@df</span><span class='hljl-t'> </span><span class='hljl-n'>auc_cmax</span><span class='hljl-t'> </span><span class='hljl-nf'>groupedviolin</span><span class='hljl-p'>(</span><span class='hljl-sc'>:DOSE</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>:cmax</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>group</span><span class='hljl-oB'>=:</span><span class='hljl-n'>Dose</span><span class='hljl-p'>,</span><span class='hljl-t'>
                      </span><span class='hljl-n'>marker</span><span class='hljl-oB'>=</span><span class='hljl-p'>(</span><span class='hljl-nfB'>0.2</span><span class='hljl-p'>,</span><span class='hljl-oB'>:</span><span class='hljl-n'>blue</span><span class='hljl-p'>,</span><span class='hljl-nf'>stroke</span><span class='hljl-p'>(</span><span class='hljl-ni'>0</span><span class='hljl-p'>)))</span><span class='hljl-t'>
</span><span class='hljl-nd'>@df</span><span class='hljl-t'> </span><span class='hljl-n'>auc_cmax</span><span class='hljl-t'> </span><span class='hljl-nf'>groupedboxplot!</span><span class='hljl-p'>(</span><span class='hljl-sc'>:DOSE</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>:cmax</span><span class='hljl-t'> </span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>group</span><span class='hljl-oB'>=:</span><span class='hljl-n'>Dose</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>label</span><span class='hljl-oB'>=</span><span class='hljl-s'>&quot;&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'>
                      </span><span class='hljl-n'>marker</span><span class='hljl-oB'>=</span><span class='hljl-p'>(</span><span class='hljl-nfB'>0.3</span><span class='hljl-p'>,</span><span class='hljl-oB'>:</span><span class='hljl-n'>orange</span><span class='hljl-p'>,</span><span class='hljl-nf'>stroke</span><span class='hljl-p'>(</span><span class='hljl-ni'>2</span><span class='hljl-p'>)),</span><span class='hljl-t'> </span><span class='hljl-n'>alpha</span><span class='hljl-oB'>=</span><span class='hljl-nfB'>0.75</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-nf'>plot!</span><span class='hljl-p'>(</span><span class='hljl-n'>size</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>(</span><span class='hljl-ni'>600</span><span class='hljl-p'>,</span><span class='hljl-ni'>600</span><span class='hljl-p'>),</span><span class='hljl-t'> </span><span class='hljl-n'>xlabel</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;Dose (mg)&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>ylabel</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;Cmax&quot;</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-cs'>#savefig(&quot;./assets/cmaxplot.png&quot;)</span>
</pre>


<p><img src="./assets/cmaxplot.png" alt="Plot cmax" /></p>
<p>Dose normalized PK parameters, <code>cmax</code> and <code>aucinf</code> were essentially dose proportional between for 5 mg, 20 mg and 80 mg doses. Based on visual inspection of the concentration time profiles as seen below, CTMNopain exhibited monophasic decline, and perhaps a one compartment model best fits the PK data.</p>



<pre class='hljl'>
<span class='hljl-n'>pkpain_noplb_plot_df</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>filter</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-t'> </span><span class='hljl-oB'>-&gt;</span><span class='hljl-t'> </span><span class='hljl-oB'>!</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-oB'>.</span><span class='hljl-n'>TIME</span><span class='hljl-t'> </span><span class='hljl-oB'>.==</span><span class='hljl-t'> </span><span class='hljl-ni'>0</span><span class='hljl-p'>),</span><span class='hljl-t'> </span><span class='hljl-n'>pkpain_noplb_df</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-nd'>@df</span><span class='hljl-t'> </span><span class='hljl-n'>pkpain_noplb_plot_df</span><span class='hljl-t'> </span><span class='hljl-nf'>plot</span><span class='hljl-p'>(</span><span class='hljl-sc'>:TIME</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>:CONC</span><span class='hljl-p'>,</span><span class='hljl-t'>
                        </span><span class='hljl-n'>color</span><span class='hljl-oB'>=:</span><span class='hljl-n'>DOSE</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>group</span><span class='hljl-oB'>=:</span><span class='hljl-n'>ID</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>legend</span><span class='hljl-oB'>=</span><span class='hljl-kc'>false</span><span class='hljl-p'>,</span><span class='hljl-t'>
                        </span><span class='hljl-n'>yaxis</span><span class='hljl-t'> </span><span class='hljl-oB'>=:</span><span class='hljl-n'>log</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>alpha</span><span class='hljl-oB'>=</span><span class='hljl-nfB'>0.2</span><span class='hljl-p'>)</span><span class='hljl-t'>

</span><span class='hljl-nd'>@df</span><span class='hljl-t'> </span><span class='hljl-n'>pkpain_noplb_plot_df</span><span class='hljl-t'> </span><span class='hljl-nf'>plot!</span><span class='hljl-p'>(</span><span class='hljl-sc'>:TIME</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>:CONC</span><span class='hljl-p'>,</span><span class='hljl-t'>
                        </span><span class='hljl-n'>group</span><span class='hljl-oB'>=:</span><span class='hljl-n'>DOSE</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>legend</span><span class='hljl-oB'>=</span><span class='hljl-kc'>false</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>linewidth</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>5</span><span class='hljl-p'>,</span><span class='hljl-t'>
                        </span><span class='hljl-n'>yaxis</span><span class='hljl-t'> </span><span class='hljl-oB'>=:</span><span class='hljl-n'>log</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>seriestype</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:Loess</span><span class='hljl-p'>,</span><span class='hljl-t'>
                        </span><span class='hljl-n'>xlabel</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;Time (hours)&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>ylabel</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;Concentration (ng/mL)&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'>
                        </span><span class='hljl-n'>size</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>(</span><span class='hljl-ni'>800</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>800</span><span class='hljl-p'>),</span><span class='hljl-t'> </span><span class='hljl-n'>guidefontsize</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>22</span><span class='hljl-p'>,</span><span class='hljl-t'>
                        </span><span class='hljl-n'>tickfontsize</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-ni'>14</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-nf'>savefig</span><span class='hljl-p'>(</span><span class='hljl-s'>&quot;./assets/spaghetti_pk.png&quot;</span><span class='hljl-p'>)</span>
</pre>


<p><img src="./assets/spaghetti_pk.png" alt="Plot spaghetti" /></p>
<h3>Pharmacokinetic modeling</h3>
<p>As seen from the plot above, the concentrations decline monoexponentially. We will evaluate both one and two compartment structural models to assess best fit. Further, different residual error models will also be tested.</p>
<p>We will use the results from NCA to provide us good initial estimates. The mean clearance is 3.29, the mean volume is 16.45 and a good initial estimate for absorption rate as obtained by <span class="math">$0.693/(tmax/4)$</span> is 3.85</p>
<h4>Data preparation for modeling</h4>
<p><a href="">PumasNDF</a> requires the presence of <code>evid</code> and <code>cmt</code> columns in the dataset.</p>


<pre class='hljl'>
<span class='hljl-n'>pkpain_noplb_df</span><span class='hljl-p'>[</span><span class='hljl-oB'>!</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>:evid</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-oB'>.=</span><span class='hljl-t'> </span><span class='hljl-n'>ifelse</span><span class='hljl-oB'>.</span><span class='hljl-p'>(</span><span class='hljl-n'>pkpain_noplb_df</span><span class='hljl-oB'>.</span><span class='hljl-n'>TIME</span><span class='hljl-t'> </span><span class='hljl-oB'>.==</span><span class='hljl-t'> </span><span class='hljl-ni'>0</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>1</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>0</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-n'>pkpain_noplb_df</span><span class='hljl-p'>[</span><span class='hljl-oB'>!</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>:cmt</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-oB'>.=</span><span class='hljl-t'> </span><span class='hljl-n'>ifelse</span><span class='hljl-oB'>.</span><span class='hljl-p'>(</span><span class='hljl-n'>pkpain_noplb_df</span><span class='hljl-oB'>.</span><span class='hljl-n'>TIME</span><span class='hljl-t'> </span><span class='hljl-oB'>.==</span><span class='hljl-t'> </span><span class='hljl-ni'>0</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>1</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>2</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-n'>pkpain_noplb_df</span><span class='hljl-p'>[</span><span class='hljl-oB'>!</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>:cmt2</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-oB'>.=</span><span class='hljl-t'> </span><span class='hljl-ni'>1</span><span class='hljl-t'> </span><span class='hljl-cs'># for zero order absorption</span>
</pre>



<p>Further, observations at time of dosing, i.e., when <code>evid &#61; 1</code> have to be <code>missing</code></p>


<pre class='hljl'>
<span class='hljl-n'>pkpain_noplb_df</span><span class='hljl-p'>[</span><span class='hljl-oB'>!</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>:CONC</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-oB'>.=</span><span class='hljl-t'> </span><span class='hljl-n'>ifelse</span><span class='hljl-oB'>.</span><span class='hljl-p'>(</span><span class='hljl-n'>pkpain_noplb_df</span><span class='hljl-oB'>.</span><span class='hljl-n'>evid</span><span class='hljl-t'> </span><span class='hljl-oB'>.==</span><span class='hljl-t'> </span><span class='hljl-ni'>1</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>missing</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>pkpain_noplb_df</span><span class='hljl-oB'>.</span><span class='hljl-n'>CONC</span><span class='hljl-p'>)</span>
</pre>



<p>The dataframe is now converted to a <a href=""><code>Population</code></a> using <a href=""><code>read_pumas</code></a>. Note that both <code>observations</code> and <code>covariates</code> are required to be an array even if it is one element.</p>


<pre class='hljl'>
<span class='hljl-n'>pkpain_noplb</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>read_pumas</span><span class='hljl-p'>(</span><span class='hljl-n'>pkpain_noplb_df</span><span class='hljl-p'>,</span><span class='hljl-t'>
                          </span><span class='hljl-n'>id</span><span class='hljl-t'>           </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:ID</span><span class='hljl-p'>,</span><span class='hljl-t'>
                          </span><span class='hljl-n'>time</span><span class='hljl-t'>         </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:TIME</span><span class='hljl-p'>,</span><span class='hljl-t'>
                          </span><span class='hljl-n'>amt</span><span class='hljl-t'>          </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:amt</span><span class='hljl-p'>,</span><span class='hljl-t'>
                          </span><span class='hljl-n'>observations</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>[</span><span class='hljl-sc'>:CONC</span><span class='hljl-p'>],</span><span class='hljl-t'>
                          </span><span class='hljl-n'>covariates</span><span class='hljl-t'>   </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>[</span><span class='hljl-sc'>:DOSE</span><span class='hljl-p'>],</span><span class='hljl-t'>
                          </span><span class='hljl-n'>evid</span><span class='hljl-t'>         </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:evid</span><span class='hljl-p'>,</span><span class='hljl-t'>
                          </span><span class='hljl-n'>cmt</span><span class='hljl-t'>          </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:cmt</span><span class='hljl-p'>)</span>
</pre>



<p>Now that the data is transformed to a <code>Population</code> of subjects, we can explore different models.</p>
<h4>One-compartment model</h4>


<pre class='hljl'>
<span class='hljl-n'>pk_1cmp</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nd'>@model</span><span class='hljl-t'> </span><span class='hljl-k'>begin</span><span class='hljl-t'>
  </span><span class='hljl-nd'>@param</span><span class='hljl-t'> </span><span class='hljl-k'>begin</span><span class='hljl-t'>
    </span><span class='hljl-n'>tvcl</span><span class='hljl-t'> </span><span class='hljl-oB'>∈</span><span class='hljl-t'> </span><span class='hljl-nf'>RealDomain</span><span class='hljl-p'>(</span><span class='hljl-n'>lower</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>0</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>init</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nfB'>3.2</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-n'>tvv</span><span class='hljl-t'>  </span><span class='hljl-oB'>∈</span><span class='hljl-t'> </span><span class='hljl-nf'>RealDomain</span><span class='hljl-p'>(</span><span class='hljl-n'>lower</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>0</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>init</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nfB'>16.4</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-n'>tvka</span><span class='hljl-t'> </span><span class='hljl-oB'>∈</span><span class='hljl-t'> </span><span class='hljl-nf'>RealDomain</span><span class='hljl-p'>(</span><span class='hljl-n'>lower</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>0</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>init</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nfB'>3.8</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-n'>Ω</span><span class='hljl-t'>    </span><span class='hljl-oB'>∈</span><span class='hljl-t'> </span><span class='hljl-nf'>PDiagDomain</span><span class='hljl-p'>(</span><span class='hljl-n'>init</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>[</span><span class='hljl-nfB'>0.04</span><span class='hljl-p'>,</span><span class='hljl-nfB'>0.04</span><span class='hljl-p'>,</span><span class='hljl-nfB'>0.04</span><span class='hljl-p'>])</span><span class='hljl-t'>
    </span><span class='hljl-n'>σ_p</span><span class='hljl-t'>  </span><span class='hljl-oB'>∈</span><span class='hljl-t'> </span><span class='hljl-nf'>RealDomain</span><span class='hljl-p'>(</span><span class='hljl-n'>lower</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nfB'>0.0001</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>init</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nfB'>0.2</span><span class='hljl-p'>)</span><span class='hljl-t'>
  </span><span class='hljl-k'>end</span><span class='hljl-t'>
  </span><span class='hljl-nd'>@random</span><span class='hljl-t'> </span><span class='hljl-k'>begin</span><span class='hljl-t'>
    </span><span class='hljl-n'>η</span><span class='hljl-t'> </span><span class='hljl-oB'>~</span><span class='hljl-t'> </span><span class='hljl-nf'>MvNormal</span><span class='hljl-p'>(</span><span class='hljl-n'>Ω</span><span class='hljl-p'>)</span><span class='hljl-t'>
  </span><span class='hljl-k'>end</span><span class='hljl-t'>
  </span><span class='hljl-nd'>@covariates</span><span class='hljl-t'> </span><span class='hljl-n'>DOSE</span><span class='hljl-t'>
  </span><span class='hljl-nd'>@pre</span><span class='hljl-t'> </span><span class='hljl-k'>begin</span><span class='hljl-t'>
    </span><span class='hljl-n'>CL</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-n'>tvcl</span><span class='hljl-t'> </span><span class='hljl-oB'>*</span><span class='hljl-t'> </span><span class='hljl-nf'>exp</span><span class='hljl-p'>(</span><span class='hljl-n'>η</span><span class='hljl-p'>[</span><span class='hljl-ni'>1</span><span class='hljl-p'>])</span><span class='hljl-t'>
    </span><span class='hljl-n'>Vc</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-n'>tvv</span><span class='hljl-t'> </span><span class='hljl-oB'>*</span><span class='hljl-t'> </span><span class='hljl-nf'>exp</span><span class='hljl-p'>(</span><span class='hljl-n'>η</span><span class='hljl-p'>[</span><span class='hljl-ni'>2</span><span class='hljl-p'>])</span><span class='hljl-t'>
    </span><span class='hljl-n'>Ka</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-n'>tvka</span><span class='hljl-t'> </span><span class='hljl-oB'>*</span><span class='hljl-t'> </span><span class='hljl-nf'>exp</span><span class='hljl-p'>(</span><span class='hljl-n'>η</span><span class='hljl-p'>[</span><span class='hljl-ni'>3</span><span class='hljl-p'>])</span><span class='hljl-t'>
  </span><span class='hljl-k'>end</span><span class='hljl-t'>
  </span><span class='hljl-nd'>@dynamics</span><span class='hljl-t'> </span><span class='hljl-n'>Depots1Central1</span><span class='hljl-t'>
  </span><span class='hljl-nd'>@derived</span><span class='hljl-t'> </span><span class='hljl-k'>begin</span><span class='hljl-t'>
    </span><span class='hljl-n'>cp</span><span class='hljl-t'> </span><span class='hljl-oB'>:=</span><span class='hljl-t'> @</span><span class='hljl-oB'>.</span><span class='hljl-t'> </span><span class='hljl-n'>Central</span><span class='hljl-oB'>/</span><span class='hljl-n'>Vc</span><span class='hljl-t'>
    </span><span class='hljl-n'>CONC</span><span class='hljl-t'> </span><span class='hljl-oB'>~</span><span class='hljl-t'> @</span><span class='hljl-oB'>.</span><span class='hljl-t'> </span><span class='hljl-nf'>Normal</span><span class='hljl-p'>(</span><span class='hljl-n'>cp</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>cp</span><span class='hljl-oB'>*</span><span class='hljl-n'>σ_p</span><span class='hljl-p'>)</span><span class='hljl-t'>
  </span><span class='hljl-k'>end</span><span class='hljl-t'>
</span><span class='hljl-k'>end</span>
</pre>


<pre class="output">
PumasModel
  Parameters: tvcl, tvv, tvka, Ω, σ_p
  Random effects: η
  Covariates: DOSE
  Dynamical variables: Depot, Central
  Derived: CONC
  Observed: CONC
</pre>


<p>Before going to fit the model, let&#39;s evaluate some helpful steps.</p>
<ol>
<li><p>Simulation to check appropriatness of data and model</p>
</li>
</ol>



<pre class='hljl'>
<span class='hljl-n'>simpk</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>simobs</span><span class='hljl-p'>(</span><span class='hljl-n'>pk_1cmp</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>pkpain_noplb</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-nf'>init_param</span><span class='hljl-p'>(</span><span class='hljl-n'>pk_1cmp</span><span class='hljl-p'>))</span><span class='hljl-t'>
</span><span class='hljl-nf'>plot</span><span class='hljl-p'>(</span><span class='hljl-n'>simpk</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>xlabel</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;Time (hours)&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>ylabel</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;Concentration (ng/mL)&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'>
    </span><span class='hljl-n'>size</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>(</span><span class='hljl-ni'>800</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>800</span><span class='hljl-p'>),</span><span class='hljl-t'> </span><span class='hljl-n'>guidefontsize</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>22</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>label</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;Simulated profiles&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'>
    </span><span class='hljl-n'>tickfontsize</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-ni'>14</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>alpha</span><span class='hljl-oB'>=</span><span class='hljl-nfB'>0.1</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>yaxis</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:log</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-cs'>#</span><span class='hljl-t'>
</span><span class='hljl-nd'>@df</span><span class='hljl-t'> </span><span class='hljl-n'>pkpain_noplb_plot_df</span><span class='hljl-t'> </span><span class='hljl-nf'>scatter!</span><span class='hljl-p'>(</span><span class='hljl-sc'>:TIME</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>:CONC</span><span class='hljl-p'>,</span><span class='hljl-t'>
                        </span><span class='hljl-n'>color</span><span class='hljl-oB'>=:</span><span class='hljl-n'>DOSE</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>group</span><span class='hljl-oB'>=:</span><span class='hljl-n'>ID</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>legend</span><span class='hljl-oB'>=</span><span class='hljl-kc'>false</span><span class='hljl-p'>,</span><span class='hljl-t'>
                        </span><span class='hljl-n'>alpha</span><span class='hljl-oB'>=</span><span class='hljl-nfB'>0.5</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>yaxis</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:log</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>label</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;Observed concentrations&quot;</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-nf'>savefig</span><span class='hljl-p'>(</span><span class='hljl-s'>&quot;./assets/sim1_pk.png&quot;</span><span class='hljl-p'>)</span>
</pre>


<p><img src="./assets/sim1_pk.png" alt="Plot sims1" /></p>
<p>Our NCA based initial guess on the parameters seem to work well.</p>
<p>Lets change the initial estimate of a couple of the parameters to evaluate the senstitivty.</p>


<pre class='hljl'>
<span class='hljl-n'>pkparam</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>(</span><span class='hljl-nf'>init_param</span><span class='hljl-p'>(</span><span class='hljl-n'>pk_1cmp</span><span class='hljl-p'>)</span><span class='hljl-oB'>...</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>tvka</span><span class='hljl-oB'>=</span><span class='hljl-ni'>2</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>tvv</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>10</span><span class='hljl-p'>)</span>
</pre>


<pre class="output">
&#40;tvcl &#61; 3.2, tvv &#61; 10, tvka &#61; 2, Ω &#61; PDMats.PDiagMat&#123;Float64,Array&#123;Float64,
1&#125;&#125;&#40;3, &#91;0.04, 0.04, 0.04&#93;, &#91;25.0, 25.0, 25.0&#93;&#41;, σ_p &#61; 0.2&#41;
</pre>




<pre class='hljl'>
<span class='hljl-n'>simpk</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>simobs</span><span class='hljl-p'>(</span><span class='hljl-n'>pk_1cmp</span><span class='hljl-p'>,</span><span class='hljl-t'>
               </span><span class='hljl-n'>pkpain_noplb</span><span class='hljl-p'>,</span><span class='hljl-t'>
               </span><span class='hljl-n'>pkparam</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-nf'>plot</span><span class='hljl-p'>(</span><span class='hljl-n'>simpk</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>xlabel</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;Time (hours)&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>ylabel</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;Concentration (ng/mL)&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'>
    </span><span class='hljl-n'>size</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>(</span><span class='hljl-ni'>800</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>800</span><span class='hljl-p'>),</span><span class='hljl-t'> </span><span class='hljl-n'>guidefontsize</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>22</span><span class='hljl-p'>,</span><span class='hljl-t'>
    </span><span class='hljl-n'>tickfontsize</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-ni'>14</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>alpha</span><span class='hljl-oB'>=</span><span class='hljl-nfB'>0.1</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>yaxis</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:log</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-cs'>#</span><span class='hljl-t'>
</span><span class='hljl-nd'>@df</span><span class='hljl-t'> </span><span class='hljl-n'>pkpain_noplb_plot_df</span><span class='hljl-t'> </span><span class='hljl-nf'>scatter!</span><span class='hljl-p'>(</span><span class='hljl-sc'>:TIME</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>:CONC</span><span class='hljl-p'>,</span><span class='hljl-t'>
                        </span><span class='hljl-n'>color</span><span class='hljl-oB'>=:</span><span class='hljl-n'>DOSE</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>group</span><span class='hljl-oB'>=:</span><span class='hljl-n'>ID</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>legend</span><span class='hljl-oB'>=</span><span class='hljl-kc'>false</span><span class='hljl-p'>,</span><span class='hljl-t'>
                        </span><span class='hljl-n'>alpha</span><span class='hljl-oB'>=</span><span class='hljl-nfB'>0.5</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>yaxis</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:log</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-nf'>savefig</span><span class='hljl-p'>(</span><span class='hljl-s'>&quot;./assets/sim2_pk.png&quot;</span><span class='hljl-p'>)</span>
</pre>


<p><img src="./assets/sim2_pk.png" alt="Plot sims2" /></p>
<p>Changing the <code>tvka</code> and decreasing the <code>tvv</code>  seemed to make an impact and observations go through the simulated lines.</p>
<p>There are two other ways to get a quick ballpark estimate of your PK parameters: NaivePooled analysis and Two-Stage Approach. Both these approaches are quite easy to perform without changing the model or the dataset. Below we test the <code>NaivePooled</code> approach</p>
<h5>NaivePooled</h5>


<pre class='hljl'>
<span class='hljl-n'>pkfit_np</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>fit</span><span class='hljl-p'>(</span><span class='hljl-n'>pk_1cmp</span><span class='hljl-p'>,</span><span class='hljl-t'>
               </span><span class='hljl-n'>pkpain_noplb</span><span class='hljl-p'>,</span><span class='hljl-t'>
               </span><span class='hljl-nf'>init_param</span><span class='hljl-p'>(</span><span class='hljl-n'>pk_1cmp</span><span class='hljl-p'>),</span><span class='hljl-n'>Pumas</span><span class='hljl-oB'>.</span><span class='hljl-nf'>NaivePooled</span><span class='hljl-p'>(),</span><span class='hljl-t'>
               </span><span class='hljl-n'>omegas</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>(</span><span class='hljl-sc'>:Ω</span><span class='hljl-p'>,))</span>
</pre>




<pre class='hljl'>
<span class='hljl-nf'>pretty_table</span><span class='hljl-p'>(</span><span class='hljl-nf'>coeftable</span><span class='hljl-p'>(</span><span class='hljl-n'>pkfit_np</span><span class='hljl-p'>),</span><span class='hljl-t'> </span><span class='hljl-n'>backend</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:html</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>formatters</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>ft_round</span><span class='hljl-p'>(</span><span class='hljl-ni'>2</span><span class='hljl-p'>,[</span><span class='hljl-ni'>2</span><span class='hljl-p'>]))</span>
</pre>



<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<style>
table, td, th {
    border-collapse: collapse;
    font-family: sans-serif;
}

td, th {
    border-bottom: 0;
    padding: 4px
}

tr:nth-child(odd) {
    background: #eee;
}

tr:nth-child(even) {
    background: #fff;
}

tr.header {
    background: navy !important;
    color: white;
    font-weight: bold;
}

tr.subheader {
    background: lightgray !important;
    color: black;
}

tr.headerLastRow {
    border-bottom: 2px solid black;
}

th.rowNumber, td.rowNumber {
    text-align: right;
}

</style>
<body>
<table>
<tr class = header>
<th style = "text-align: right; ">parameter</th>
<th style = "text-align: right; ">estimate</th>
</tr>
<tr class = "subheader headerLastRow">
<th style = "text-align: right; ">String</th>
<th style = "text-align: right; ">Float64</th>
</tr>
<tr>
<td style = "text-align: right; ">tvcl</td>
<td style = "text-align: right; ">3.01</td>
</tr>
<tr>
<td style = "text-align: right; ">tvv</td>
<td style = "text-align: right; ">14.09</td>
</tr>
<tr>
<td style = "text-align: right; ">tvka</td>
<td style = "text-align: right; ">45.61</td>
</tr>
<tr>
<td style = "text-align: right; ">Ω₁,₁</td>
<td style = "text-align: right; ">0.0</td>
</tr>
<tr>
<td style = "text-align: right; ">Ω₂,₂</td>
<td style = "text-align: right; ">0.0</td>
</tr>
<tr>
<td style = "text-align: right; ">Ω₃,₃</td>
<td style = "text-align: right; ">0.0</td>
</tr>
<tr>
<td style = "text-align: right; ">σ_p</td>
<td style = "text-align: right; ">0.33</td>
</tr>
</table>
</body>
</html>


<p>The final estimates from the NaivePooled approach seem reasonably close to our initial guess from NCA, except for the <code>tvka</code> parameter. We will stick with our initial guess</p>
<p>One way to be cautious before going into a complete <code>fit</code>ing routine is to evaluate the likelihood of the individual subjects given the initial parameter values and see if anyone pops out as unreasonable. There are a few ways of doing this that will be introduce later, but here we will be checking the <code>loglikelihood</code> subject wise.</p>
<p>Below, we are basically checking if the initial estimates for any subject are way off that we are unable to compute the initial <code>loglikelihood</code>.</p>



<pre class='hljl'>
<span class='hljl-n'>lls</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>[]</span><span class='hljl-t'>
</span><span class='hljl-k'>for</span><span class='hljl-t'> </span><span class='hljl-n'>subj</span><span class='hljl-t'> </span><span class='hljl-kp'>in</span><span class='hljl-t'> </span><span class='hljl-n'>pkpain_noplb</span><span class='hljl-t'>
  </span><span class='hljl-cs'>#println(&quot;ID: &quot; , subj.id)</span><span class='hljl-t'>
  </span><span class='hljl-nf'>push!</span><span class='hljl-p'>(</span><span class='hljl-n'>lls</span><span class='hljl-p'>,</span><span class='hljl-nf'>loglikelihood</span><span class='hljl-p'>(</span><span class='hljl-n'>pk_1cmp</span><span class='hljl-p'>,</span><span class='hljl-t'>
                   </span><span class='hljl-n'>subj</span><span class='hljl-p'>,</span><span class='hljl-t'>
                   </span><span class='hljl-n'>pkparam</span><span class='hljl-p'>,</span><span class='hljl-t'>
                   </span><span class='hljl-n'>Pumas</span><span class='hljl-oB'>.</span><span class='hljl-nf'>FOCEI</span><span class='hljl-p'>()))</span><span class='hljl-t'>
</span><span class='hljl-k'>end</span><span class='hljl-t'>
</span><span class='hljl-nf'>histogram</span><span class='hljl-p'>(</span><span class='hljl-n'>lls</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>size</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>(</span><span class='hljl-ni'>800</span><span class='hljl-p'>,</span><span class='hljl-ni'>800</span><span class='hljl-p'>))</span><span class='hljl-t'>
</span><span class='hljl-cs'>#savefig(&quot;./assets/histlls.png&quot;)</span>
</pre>


<p><img src="./assets/histlls.png" alt="Plot lls" /></p>
<p>The distribution of the loglikelihood&#39;s suggest no extreme outliers.</p>
<p>Now that we have a good handle on our data, lets go ahead and <code>fit</code> a population model</p>


<pre class='hljl'>
<span class='hljl-n'>pkfit_1cmp</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>fit</span><span class='hljl-p'>(</span><span class='hljl-n'>pk_1cmp</span><span class='hljl-p'>,</span><span class='hljl-t'>
                 </span><span class='hljl-n'>pkpain_noplb</span><span class='hljl-p'>,</span><span class='hljl-t'>
                 </span><span class='hljl-n'>pkparam</span><span class='hljl-p'>,</span><span class='hljl-t'>
                 </span><span class='hljl-n'>Pumas</span><span class='hljl-oB'>.</span><span class='hljl-nf'>FOCEI</span><span class='hljl-p'>(),</span><span class='hljl-t'> </span><span class='hljl-n'>ensemblealg</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>EnsembleThreads</span><span class='hljl-p'>(),</span><span class='hljl-t'>
                 </span><span class='hljl-n'>constantcoef</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>(</span><span class='hljl-n'>tvka</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>2</span><span class='hljl-p'>,))</span>
</pre>




<pre class='hljl'>
<span class='hljl-nf'>pretty_table</span><span class='hljl-p'>(</span><span class='hljl-nf'>coeftable</span><span class='hljl-p'>(</span><span class='hljl-n'>pkfit_1cmp</span><span class='hljl-p'>),</span><span class='hljl-n'>backend</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:html</span><span class='hljl-p'>,</span><span class='hljl-t'>  </span><span class='hljl-n'>formatters</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>ft_round</span><span class='hljl-p'>(</span><span class='hljl-ni'>2</span><span class='hljl-p'>,[</span><span class='hljl-ni'>2</span><span class='hljl-p'>]))</span>
</pre>



<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<style>
table, td, th {
    border-collapse: collapse;
    font-family: sans-serif;
}

td, th {
    border-bottom: 0;
    padding: 4px
}

tr:nth-child(odd) {
    background: #eee;
}

tr:nth-child(even) {
    background: #fff;
}

tr.header {
    background: navy !important;
    color: white;
    font-weight: bold;
}

tr.subheader {
    background: lightgray !important;
    color: black;
}

tr.headerLastRow {
    border-bottom: 2px solid black;
}

th.rowNumber, td.rowNumber {
    text-align: right;
}

</style>
<body>
<table>
<tr class = header>
<th style = "text-align: right; ">parameter</th>
<th style = "text-align: right; ">estimate</th>
</tr>
<tr class = "subheader headerLastRow">
<th style = "text-align: right; ">String</th>
<th style = "text-align: right; ">Float64</th>
</tr>
<tr>
<td style = "text-align: right; ">tvcl</td>
<td style = "text-align: right; ">3.16</td>
</tr>
<tr>
<td style = "text-align: right; ">tvv</td>
<td style = "text-align: right; ">13.29</td>
</tr>
<tr>
<td style = "text-align: right; ">tvka</td>
<td style = "text-align: right; ">2.0</td>
</tr>
<tr>
<td style = "text-align: right; ">Ω₁,₁</td>
<td style = "text-align: right; ">0.08</td>
</tr>
<tr>
<td style = "text-align: right; ">Ω₂,₂</td>
<td style = "text-align: right; ">0.05</td>
</tr>
<tr>
<td style = "text-align: right; ">Ω₃,₃</td>
<td style = "text-align: right; ">5.58</td>
</tr>
<tr>
<td style = "text-align: right; ">σ_p</td>
<td style = "text-align: right; ">0.1</td>
</tr>
</table>
</body>
</html>


<p>Notice that I fixed the <code>tvka</code> to 2 as I we don&#39;t have a lot of information before <code>tmax</code>. From the table below, we see that the parameter precision for this model is reasonable.</p>


<pre class='hljl'>
<span class='hljl-nf'>pretty_table</span><span class='hljl-p'>(</span><span class='hljl-nf'>coeftable</span><span class='hljl-p'>(</span><span class='hljl-nf'>infer</span><span class='hljl-p'>(</span><span class='hljl-n'>pkfit_1cmp</span><span class='hljl-p'>)),</span><span class='hljl-t'> </span><span class='hljl-n'>backend</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:html</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>formatters</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>ft_round</span><span class='hljl-p'>(</span><span class='hljl-ni'>2</span><span class='hljl-p'>,[</span><span class='hljl-ni'>2</span><span class='hljl-p'>,</span><span class='hljl-ni'>3</span><span class='hljl-p'>,</span><span class='hljl-ni'>4</span><span class='hljl-p'>,</span><span class='hljl-ni'>5</span><span class='hljl-p'>]))</span>
</pre>


<pre class="output">
Calculating: variance-covariance matrix. Done.
</pre>


<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<style>
table, td, th {
    border-collapse: collapse;
    font-family: sans-serif;
}

td, th {
    border-bottom: 0;
    padding: 4px
}

tr:nth-child(odd) {
    background: #eee;
}

tr:nth-child(even) {
    background: #fff;
}

tr.header {
    background: navy !important;
    color: white;
    font-weight: bold;
}

tr.subheader {
    background: lightgray !important;
    color: black;
}

tr.headerLastRow {
    border-bottom: 2px solid black;
}

th.rowNumber, td.rowNumber {
    text-align: right;
}

</style>
<body>
<table>
<tr class = header>
<th style = "text-align: right; ">parameter</th>
<th style = "text-align: right; ">estimate</th>
<th style = "text-align: right; ">se</th>
<th style = "text-align: right; ">ci_lower</th>
<th style = "text-align: right; ">ci_upper</th>
</tr>
<tr class = "subheader headerLastRow">
<th style = "text-align: right; ">String</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
</tr>
<tr>
<td style = "text-align: right; ">tvcl</td>
<td style = "text-align: right; ">3.16</td>
<td style = "text-align: right; ">0.09</td>
<td style = "text-align: right; ">2.99</td>
<td style = "text-align: right; ">3.33</td>
</tr>
<tr>
<td style = "text-align: right; ">tvv</td>
<td style = "text-align: right; ">13.29</td>
<td style = "text-align: right; ">0.27</td>
<td style = "text-align: right; ">12.75</td>
<td style = "text-align: right; ">13.83</td>
</tr>
<tr>
<td style = "text-align: right; ">tvka</td>
<td style = "text-align: right; ">2.0</td>
<td style = "text-align: right; ">NaN</td>
<td style = "text-align: right; ">NaN</td>
<td style = "text-align: right; ">NaN</td>
</tr>
<tr>
<td style = "text-align: right; ">Ω₁,₁</td>
<td style = "text-align: right; ">0.08</td>
<td style = "text-align: right; ">0.01</td>
<td style = "text-align: right; ">0.06</td>
<td style = "text-align: right; ">0.11</td>
</tr>
<tr>
<td style = "text-align: right; ">Ω₂,₂</td>
<td style = "text-align: right; ">0.05</td>
<td style = "text-align: right; ">0.01</td>
<td style = "text-align: right; ">0.04</td>
<td style = "text-align: right; ">0.06</td>
</tr>
<tr>
<td style = "text-align: right; ">Ω₃,₃</td>
<td style = "text-align: right; ">5.58</td>
<td style = "text-align: right; ">1.22</td>
<td style = "text-align: right; ">3.19</td>
<td style = "text-align: right; ">7.97</td>
</tr>
<tr>
<td style = "text-align: right; ">σ_p</td>
<td style = "text-align: right; ">0.1</td>
<td style = "text-align: right; ">0.01</td>
<td style = "text-align: right; ">0.09</td>
<td style = "text-align: right; ">0.11</td>
</tr>
</table>
</body>
</html>


<p>Just to be sure, let&#39;s fit a 2-compartment model and evaluate</p>


<pre class='hljl'>
<span class='hljl-n'>pk_2cmp</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nd'>@model</span><span class='hljl-t'> </span><span class='hljl-k'>begin</span><span class='hljl-t'>
  </span><span class='hljl-nd'>@param</span><span class='hljl-t'> </span><span class='hljl-k'>begin</span><span class='hljl-t'>
    </span><span class='hljl-n'>tvcl</span><span class='hljl-t'> </span><span class='hljl-oB'>∈</span><span class='hljl-t'> </span><span class='hljl-nf'>RealDomain</span><span class='hljl-p'>(</span><span class='hljl-n'>lower</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>0</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>init</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nfB'>3.2</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-n'>tvv</span><span class='hljl-t'>  </span><span class='hljl-oB'>∈</span><span class='hljl-t'> </span><span class='hljl-nf'>RealDomain</span><span class='hljl-p'>(</span><span class='hljl-n'>lower</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>0</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>init</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nfB'>16.4</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-n'>tvvp</span><span class='hljl-t'> </span><span class='hljl-oB'>∈</span><span class='hljl-t'> </span><span class='hljl-nf'>RealDomain</span><span class='hljl-p'>(</span><span class='hljl-n'>lower</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>0</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>init</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>10</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-n'>tvq</span><span class='hljl-t'>  </span><span class='hljl-oB'>∈</span><span class='hljl-t'> </span><span class='hljl-nf'>RealDomain</span><span class='hljl-p'>(</span><span class='hljl-n'>lower</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>0</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>init</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>2</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-n'>tvka</span><span class='hljl-t'> </span><span class='hljl-oB'>∈</span><span class='hljl-t'> </span><span class='hljl-nf'>RealDomain</span><span class='hljl-p'>(</span><span class='hljl-n'>lower</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>0</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>init</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nfB'>1.3</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-n'>Ω</span><span class='hljl-t'>    </span><span class='hljl-oB'>∈</span><span class='hljl-t'> </span><span class='hljl-nf'>PDiagDomain</span><span class='hljl-p'>(</span><span class='hljl-n'>init</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>[</span><span class='hljl-nfB'>0.04</span><span class='hljl-p'>,</span><span class='hljl-nfB'>0.04</span><span class='hljl-p'>,</span><span class='hljl-nfB'>0.04</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-nfB'>0.04</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-nfB'>0.04</span><span class='hljl-p'>])</span><span class='hljl-t'>
    </span><span class='hljl-n'>σ_p</span><span class='hljl-t'>  </span><span class='hljl-oB'>∈</span><span class='hljl-t'> </span><span class='hljl-nf'>RealDomain</span><span class='hljl-p'>(</span><span class='hljl-n'>lower</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nfB'>0.0001</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>init</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nfB'>0.2</span><span class='hljl-p'>)</span><span class='hljl-t'>
  </span><span class='hljl-k'>end</span><span class='hljl-t'>
  </span><span class='hljl-nd'>@random</span><span class='hljl-t'> </span><span class='hljl-k'>begin</span><span class='hljl-t'>
    </span><span class='hljl-n'>η</span><span class='hljl-t'> </span><span class='hljl-oB'>~</span><span class='hljl-t'> </span><span class='hljl-nf'>MvNormal</span><span class='hljl-p'>(</span><span class='hljl-n'>Ω</span><span class='hljl-p'>)</span><span class='hljl-t'>
  </span><span class='hljl-k'>end</span><span class='hljl-t'>
  </span><span class='hljl-nd'>@covariates</span><span class='hljl-t'> </span><span class='hljl-n'>DOSE</span><span class='hljl-t'>
  </span><span class='hljl-nd'>@pre</span><span class='hljl-t'> </span><span class='hljl-k'>begin</span><span class='hljl-t'>
    </span><span class='hljl-n'>CL</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-n'>tvcl</span><span class='hljl-t'> </span><span class='hljl-oB'>*</span><span class='hljl-t'> </span><span class='hljl-nf'>exp</span><span class='hljl-p'>(</span><span class='hljl-n'>η</span><span class='hljl-p'>[</span><span class='hljl-ni'>1</span><span class='hljl-p'>])</span><span class='hljl-t'>
    </span><span class='hljl-n'>Vc</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-n'>tvv</span><span class='hljl-t'> </span><span class='hljl-oB'>*</span><span class='hljl-t'> </span><span class='hljl-nf'>exp</span><span class='hljl-p'>(</span><span class='hljl-n'>η</span><span class='hljl-p'>[</span><span class='hljl-ni'>2</span><span class='hljl-p'>])</span><span class='hljl-t'>
    </span><span class='hljl-n'>Ka</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-n'>tvka</span><span class='hljl-t'> </span><span class='hljl-oB'>*</span><span class='hljl-t'> </span><span class='hljl-nf'>exp</span><span class='hljl-p'>(</span><span class='hljl-n'>η</span><span class='hljl-p'>[</span><span class='hljl-ni'>3</span><span class='hljl-p'>])</span><span class='hljl-t'>
    </span><span class='hljl-n'>Vp</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-n'>tvvp</span><span class='hljl-t'> </span><span class='hljl-oB'>*</span><span class='hljl-t'> </span><span class='hljl-nf'>exp</span><span class='hljl-p'>(</span><span class='hljl-n'>η</span><span class='hljl-p'>[</span><span class='hljl-ni'>4</span><span class='hljl-p'>])</span><span class='hljl-t'>
    </span><span class='hljl-n'>Q</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-n'>tvq</span><span class='hljl-t'> </span><span class='hljl-oB'>*</span><span class='hljl-t'> </span><span class='hljl-nf'>exp</span><span class='hljl-p'>(</span><span class='hljl-n'>η</span><span class='hljl-p'>[</span><span class='hljl-ni'>5</span><span class='hljl-p'>])</span><span class='hljl-t'>
  </span><span class='hljl-k'>end</span><span class='hljl-t'>
  </span><span class='hljl-nd'>@dynamics</span><span class='hljl-t'> </span><span class='hljl-n'>Depots1Central1Periph1</span><span class='hljl-t'>
  </span><span class='hljl-nd'>@derived</span><span class='hljl-t'> </span><span class='hljl-k'>begin</span><span class='hljl-t'>
    </span><span class='hljl-n'>cp</span><span class='hljl-t'> </span><span class='hljl-oB'>:=</span><span class='hljl-t'> @</span><span class='hljl-oB'>.</span><span class='hljl-t'> </span><span class='hljl-n'>Central</span><span class='hljl-oB'>/</span><span class='hljl-n'>Vc</span><span class='hljl-t'>
    </span><span class='hljl-n'>CONC</span><span class='hljl-t'> </span><span class='hljl-oB'>~</span><span class='hljl-t'> @</span><span class='hljl-oB'>.</span><span class='hljl-t'> </span><span class='hljl-nf'>Normal</span><span class='hljl-p'>(</span><span class='hljl-n'>cp</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>cp</span><span class='hljl-oB'>*</span><span class='hljl-n'>σ_p</span><span class='hljl-p'>)</span><span class='hljl-t'>
  </span><span class='hljl-k'>end</span><span class='hljl-t'>
</span><span class='hljl-k'>end</span>
</pre>


<pre class="output">
PumasModel
  Parameters: tvcl, tvv, tvvp, tvq, tvka, Ω, σ_p
  Random effects: η
  Covariates: DOSE
  Dynamical variables: Depot, Central, Peripheral
  Derived: CONC
  Observed: CONC
</pre>



<pre class='hljl'>
<span class='hljl-n'>pkfit_2cmp</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>fit</span><span class='hljl-p'>(</span><span class='hljl-n'>pk_2cmp</span><span class='hljl-p'>,</span><span class='hljl-t'>
                 </span><span class='hljl-n'>pkpain_noplb</span><span class='hljl-p'>,</span><span class='hljl-t'>
                 </span><span class='hljl-nf'>init_param</span><span class='hljl-p'>(</span><span class='hljl-n'>pk_2cmp</span><span class='hljl-p'>),</span><span class='hljl-t'>
                 </span><span class='hljl-n'>Pumas</span><span class='hljl-oB'>.</span><span class='hljl-nf'>FOCEI</span><span class='hljl-p'>(),</span><span class='hljl-t'> </span><span class='hljl-n'>ensemblealg</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>EnsembleThreads</span><span class='hljl-p'>(),</span><span class='hljl-t'>
                 </span><span class='hljl-n'>constantcoef</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>(</span><span class='hljl-n'>tvka</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>2</span><span class='hljl-p'>,))</span>
</pre>




<pre class='hljl'>
<span class='hljl-nf'>pretty_table</span><span class='hljl-p'>(</span><span class='hljl-nf'>coeftable</span><span class='hljl-p'>(</span><span class='hljl-nf'>infer</span><span class='hljl-p'>(</span><span class='hljl-n'>pkfit_1cmp</span><span class='hljl-p'>)),</span><span class='hljl-t'> </span><span class='hljl-n'>backend</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:html</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>formatters</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>ft_round</span><span class='hljl-p'>(</span><span class='hljl-ni'>2</span><span class='hljl-p'>,[</span><span class='hljl-ni'>2</span><span class='hljl-p'>,</span><span class='hljl-ni'>3</span><span class='hljl-p'>,</span><span class='hljl-ni'>4</span><span class='hljl-p'>,</span><span class='hljl-ni'>5</span><span class='hljl-p'>]))</span>
</pre>


<pre class="output">
Calculating: variance-covariance matrix. Done.
</pre>


<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<style>
table, td, th {
    border-collapse: collapse;
    font-family: sans-serif;
}

td, th {
    border-bottom: 0;
    padding: 4px
}

tr:nth-child(odd) {
    background: #eee;
}

tr:nth-child(even) {
    background: #fff;
}

tr.header {
    background: navy !important;
    color: white;
    font-weight: bold;
}

tr.subheader {
    background: lightgray !important;
    color: black;
}

tr.headerLastRow {
    border-bottom: 2px solid black;
}

th.rowNumber, td.rowNumber {
    text-align: right;
}

</style>
<body>
<table>
<tr class = header>
<th style = "text-align: right; ">parameter</th>
<th style = "text-align: right; ">estimate</th>
<th style = "text-align: right; ">se</th>
<th style = "text-align: right; ">ci_lower</th>
<th style = "text-align: right; ">ci_upper</th>
</tr>
<tr class = "subheader headerLastRow">
<th style = "text-align: right; ">String</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
</tr>
<tr>
<td style = "text-align: right; ">tvcl</td>
<td style = "text-align: right; ">3.16</td>
<td style = "text-align: right; ">0.09</td>
<td style = "text-align: right; ">2.99</td>
<td style = "text-align: right; ">3.33</td>
</tr>
<tr>
<td style = "text-align: right; ">tvv</td>
<td style = "text-align: right; ">13.29</td>
<td style = "text-align: right; ">0.27</td>
<td style = "text-align: right; ">12.75</td>
<td style = "text-align: right; ">13.83</td>
</tr>
<tr>
<td style = "text-align: right; ">tvka</td>
<td style = "text-align: right; ">2.0</td>
<td style = "text-align: right; ">NaN</td>
<td style = "text-align: right; ">NaN</td>
<td style = "text-align: right; ">NaN</td>
</tr>
<tr>
<td style = "text-align: right; ">Ω₁,₁</td>
<td style = "text-align: right; ">0.08</td>
<td style = "text-align: right; ">0.01</td>
<td style = "text-align: right; ">0.06</td>
<td style = "text-align: right; ">0.11</td>
</tr>
<tr>
<td style = "text-align: right; ">Ω₂,₂</td>
<td style = "text-align: right; ">0.05</td>
<td style = "text-align: right; ">0.01</td>
<td style = "text-align: right; ">0.04</td>
<td style = "text-align: right; ">0.06</td>
</tr>
<tr>
<td style = "text-align: right; ">Ω₃,₃</td>
<td style = "text-align: right; ">5.58</td>
<td style = "text-align: right; ">1.22</td>
<td style = "text-align: right; ">3.19</td>
<td style = "text-align: right; ">7.97</td>
</tr>
<tr>
<td style = "text-align: right; ">σ_p</td>
<td style = "text-align: right; ">0.1</td>
<td style = "text-align: right; ">0.01</td>
<td style = "text-align: right; ">0.09</td>
<td style = "text-align: right; ">0.11</td>
</tr>
</table>
</body>
</html>


<p>The 2 compartment model has a much lower objective function compared to the 1 compartment. Lets compare the estimates from the 2 models.</p>


<pre class='hljl'>
<span class='hljl-nd'>@pipe</span><span class='hljl-t'> </span><span class='hljl-nf'>leftjoin</span><span class='hljl-p'>(</span><span class='hljl-nf'>coeftable</span><span class='hljl-p'>(</span><span class='hljl-n'>pkfit_2cmp</span><span class='hljl-p'>),</span><span class='hljl-t'>
               </span><span class='hljl-nf'>coeftable</span><span class='hljl-p'>(</span><span class='hljl-n'>pkfit_1cmp</span><span class='hljl-p'>),</span><span class='hljl-t'> </span><span class='hljl-n'>on</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:parameter</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>makeunique</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-kc'>true</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-oB'>|&gt;</span><span class='hljl-t'>
  </span><span class='hljl-nf'>rename!</span><span class='hljl-p'>(</span><span class='hljl-n'>_</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>:estimate</span><span class='hljl-t'> </span><span class='hljl-oB'>=&gt;</span><span class='hljl-t'> </span><span class='hljl-sc'>:pk2cmp</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>:estimate_1</span><span class='hljl-t'> </span><span class='hljl-oB'>=&gt;</span><span class='hljl-t'> </span><span class='hljl-sc'>:pk1cmp</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-oB'>|&gt;</span><span class='hljl-t'>
  </span><span class='hljl-nf'>pretty_table</span><span class='hljl-p'>(</span><span class='hljl-n'>_</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>backend</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:html</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>formatters</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>ft_round</span><span class='hljl-p'>(</span><span class='hljl-ni'>2</span><span class='hljl-p'>,[</span><span class='hljl-ni'>2</span><span class='hljl-p'>,</span><span class='hljl-ni'>3</span><span class='hljl-p'>]))</span>
</pre>



<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<style>
table, td, th {
    border-collapse: collapse;
    font-family: sans-serif;
}

td, th {
    border-bottom: 0;
    padding: 4px
}

tr:nth-child(odd) {
    background: #eee;
}

tr:nth-child(even) {
    background: #fff;
}

tr.header {
    background: navy !important;
    color: white;
    font-weight: bold;
}

tr.subheader {
    background: lightgray !important;
    color: black;
}

tr.headerLastRow {
    border-bottom: 2px solid black;
}

th.rowNumber, td.rowNumber {
    text-align: right;
}

</style>
<body>
<table>
<tr class = header>
<th style = "text-align: right; ">parameter</th>
<th style = "text-align: right; ">pk2cmp</th>
<th style = "text-align: right; ">pk1cmp</th>
</tr>
<tr class = "subheader headerLastRow">
<th style = "text-align: right; ">String</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Union{Missing, Float64}</th>
</tr>
<tr>
<td style = "text-align: right; ">tvcl</td>
<td style = "text-align: right; ">2.85</td>
<td style = "text-align: right; ">3.16</td>
</tr>
<tr>
<td style = "text-align: right; ">tvv</td>
<td style = "text-align: right; ">10.99</td>
<td style = "text-align: right; ">13.29</td>
</tr>
<tr>
<td style = "text-align: right; ">tvvp</td>
<td style = "text-align: right; ">5.05</td>
<td style = "text-align: right; ">missing</td>
</tr>
<tr>
<td style = "text-align: right; ">tvq</td>
<td style = "text-align: right; ">1.53</td>
<td style = "text-align: right; ">missing</td>
</tr>
<tr>
<td style = "text-align: right; ">tvka</td>
<td style = "text-align: right; ">2.0</td>
<td style = "text-align: right; ">2.0</td>
</tr>
<tr>
<td style = "text-align: right; ">Ω₁,₁</td>
<td style = "text-align: right; ">0.1</td>
<td style = "text-align: right; ">0.08</td>
</tr>
<tr>
<td style = "text-align: right; ">Ω₂,₂</td>
<td style = "text-align: right; ">0.06</td>
<td style = "text-align: right; ">0.05</td>
</tr>
<tr>
<td style = "text-align: right; ">Ω₃,₃</td>
<td style = "text-align: right; ">1.13</td>
<td style = "text-align: right; ">5.58</td>
</tr>
<tr>
<td style = "text-align: right; ">Ω₄,₄</td>
<td style = "text-align: right; ">0.46</td>
<td style = "text-align: right; ">missing</td>
</tr>
<tr>
<td style = "text-align: right; ">Ω₅,₅</td>
<td style = "text-align: right; ">0.24</td>
<td style = "text-align: right; ">missing</td>
</tr>
<tr>
<td style = "text-align: right; ">σ_p</td>
<td style = "text-align: right; ">0.05</td>
<td style = "text-align: right; ">0.1</td>
</tr>
</table>
</body>
</html>


<p>We perform a likelihood ratio test to compare the two nested models. The test statistic and the P-value clearly indicate that a 2 compartment model is better.</p>


<pre class='hljl'>
<span class='hljl-nf'>lrtest</span><span class='hljl-p'>(</span><span class='hljl-n'>pkfit_1cmp</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>pkfit_2cmp</span><span class='hljl-p'>)</span>
</pre>


<pre class="output">
Statistic:          1190.0
Degrees of freedom:      4
P-value:               0.0
</pre>


<p>We should also compare the other metrics and statistics, such <code>ηshrinkage</code>, <code>ϵshrinkage</code>, <code>aic</code>, <code>bic</code></p>
<p>#TODO make the code below generate a dataframe or some structure that allows comparison</p>



<pre class='hljl'>
<span class='hljl-k'>for</span><span class='hljl-t'> </span><span class='hljl-n'>model</span><span class='hljl-t'> </span><span class='hljl-kp'>in</span><span class='hljl-t'> </span><span class='hljl-p'>[</span><span class='hljl-n'>pkfit_1cmp</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>pkfit_2cmp</span><span class='hljl-p'>]</span><span class='hljl-t'>
  </span><span class='hljl-nf'>ηshrinkage</span><span class='hljl-p'>(</span><span class='hljl-n'>model</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-k'>end</span>
</pre>


<p>We next generate some goodness of fit plots to compare which model is performing better. To do this, we first <code>inspect</code> the diagnostics of our model fit.</p>


<pre class='hljl'>
<span class='hljl-n'>res_inspect_1cmp</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>DataFrame</span><span class='hljl-p'>(</span><span class='hljl-nf'>inspect</span><span class='hljl-p'>(</span><span class='hljl-n'>pkfit_1cmp</span><span class='hljl-p'>))</span><span class='hljl-t'>
</span><span class='hljl-nf'>dropmissing!</span><span class='hljl-p'>(</span><span class='hljl-n'>res_inspect_1cmp</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-nf'>pretty_table</span><span class='hljl-p'>(</span><span class='hljl-nf'>first</span><span class='hljl-p'>(</span><span class='hljl-n'>res_inspect_1cmp</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>10</span><span class='hljl-p'>),</span><span class='hljl-t'> </span><span class='hljl-n'>backend</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:html</span><span class='hljl-p'>,</span><span class='hljl-n'>formatters</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>ft_round</span><span class='hljl-p'>(</span><span class='hljl-ni'>2</span><span class='hljl-p'>,[</span><span class='hljl-ni'>4</span><span class='hljl-p'>,</span><span class='hljl-ni'>5</span><span class='hljl-p'>,</span><span class='hljl-ni'>6</span><span class='hljl-p'>,</span><span class='hljl-ni'>7</span><span class='hljl-p'>,</span><span class='hljl-ni'>8</span><span class='hljl-p'>,</span><span class='hljl-ni'>10</span><span class='hljl-p'>,</span><span class='hljl-ni'>11</span><span class='hljl-p'>,</span><span class='hljl-ni'>12</span><span class='hljl-p'>,</span><span class='hljl-ni'>13</span><span class='hljl-p'>,</span><span class='hljl-ni'>14</span><span class='hljl-p'>]))</span>
</pre>


<pre class="output">
Calculating: predictions, weighted residuals, empirical bayes. Done.
</pre>


<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<style>
table, td, th {
    border-collapse: collapse;
    font-family: sans-serif;
}

td, th {
    border-bottom: 0;
    padding: 4px
}

tr:nth-child(odd) {
    background: #eee;
}

tr:nth-child(even) {
    background: #fff;
}

tr.header {
    background: navy !important;
    color: white;
    font-weight: bold;
}

tr.subheader {
    background: lightgray !important;
    color: black;
}

tr.headerLastRow {
    border-bottom: 2px solid black;
}

th.rowNumber, td.rowNumber {
    text-align: right;
}

</style>
<body>
<table>
<tr class = header>
<th style = "text-align: right; ">id</th>
<th style = "text-align: right; ">time</th>
<th style = "text-align: right; ">evid</th>
<th style = "text-align: right; ">CONC</th>
<th style = "text-align: right; ">CONC_pred</th>
<th style = "text-align: right; ">CONC_ipred</th>
<th style = "text-align: right; ">CONC_wres</th>
<th style = "text-align: right; ">CONC_iwres</th>
<th style = "text-align: right; ">wres_approx</th>
<th style = "text-align: right; ">η_1</th>
<th style = "text-align: right; ">η_2</th>
<th style = "text-align: right; ">η_3</th>
<th style = "text-align: right; ">DOSE</th>
</tr>
<tr class = "subheader headerLastRow">
<th style = "text-align: right; ">String</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Int64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Pumas.FOCEI</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Int64</th>
</tr>
<tr>
<td style = "text-align: right; ">1</td>
<td style = "text-align: right; ">0.5</td>
<td style = "text-align: right; ">0</td>
<td style = "text-align: right; ">1.16</td>
<td style = "text-align: right; ">0.89</td>
<td style = "text-align: right; ">1.15</td>
<td style = "text-align: right; ">0.19</td>
<td style = "text-align: right; ">0.07</td>
<td style = "text-align: right; ">Pumas.FOCEI()</td>
<td style = "text-align: right; ">-0.14</td>
<td style = "text-align: right; ">-0.13</td>
<td style = "text-align: right; ">0.24</td>
<td style = "text-align: right; ">20.0</td>
</tr>
<tr>
<td style = "text-align: right; ">1</td>
<td style = "text-align: right; ">1.0</td>
<td style = "text-align: right; ">0</td>
<td style = "text-align: right; ">1.37</td>
<td style = "text-align: right; ">1.12</td>
<td style = "text-align: right; ">1.34</td>
<td style = "text-align: right; ">0.4</td>
<td style = "text-align: right; ">0.24</td>
<td style = "text-align: right; ">Pumas.FOCEI()</td>
<td style = "text-align: right; ">-0.14</td>
<td style = "text-align: right; ">-0.13</td>
<td style = "text-align: right; ">0.24</td>
<td style = "text-align: right; ">20.0</td>
</tr>
<tr>
<td style = "text-align: right; ">1</td>
<td style = "text-align: right; ">1.5</td>
<td style = "text-align: right; ">0</td>
<td style = "text-align: right; ">1.3</td>
<td style = "text-align: right; ">1.11</td>
<td style = "text-align: right; ">1.28</td>
<td style = "text-align: right; ">0.31</td>
<td style = "text-align: right; ">0.15</td>
<td style = "text-align: right; ">Pumas.FOCEI()</td>
<td style = "text-align: right; ">-0.14</td>
<td style = "text-align: right; ">-0.13</td>
<td style = "text-align: right; ">0.24</td>
<td style = "text-align: right; ">20.0</td>
</tr>
<tr>
<td style = "text-align: right; ">1</td>
<td style = "text-align: right; ">2.0</td>
<td style = "text-align: right; ">0</td>
<td style = "text-align: right; ">1.19</td>
<td style = "text-align: right; ">1.03</td>
<td style = "text-align: right; ">1.16</td>
<td style = "text-align: right; ">0.39</td>
<td style = "text-align: right; ">0.24</td>
<td style = "text-align: right; ">Pumas.FOCEI()</td>
<td style = "text-align: right; ">-0.14</td>
<td style = "text-align: right; ">-0.13</td>
<td style = "text-align: right; ">0.24</td>
<td style = "text-align: right; ">20.0</td>
</tr>
<tr>
<td style = "text-align: right; ">1</td>
<td style = "text-align: right; ">2.5</td>
<td style = "text-align: right; ">0</td>
<td style = "text-align: right; ">1.14</td>
<td style = "text-align: right; ">0.93</td>
<td style = "text-align: right; ">1.04</td>
<td style = "text-align: right; ">1.03</td>
<td style = "text-align: right; ">0.9</td>
<td style = "text-align: right; ">Pumas.FOCEI()</td>
<td style = "text-align: right; ">-0.14</td>
<td style = "text-align: right; ">-0.13</td>
<td style = "text-align: right; ">0.24</td>
<td style = "text-align: right; ">20.0</td>
</tr>
<tr>
<td style = "text-align: right; ">1</td>
<td style = "text-align: right; ">3.0</td>
<td style = "text-align: right; ">0</td>
<td style = "text-align: right; ">0.87</td>
<td style = "text-align: right; ">0.83</td>
<td style = "text-align: right; ">0.93</td>
<td style = "text-align: right; ">-0.46</td>
<td style = "text-align: right; ">-0.59</td>
<td style = "text-align: right; ">Pumas.FOCEI()</td>
<td style = "text-align: right; ">-0.14</td>
<td style = "text-align: right; ">-0.13</td>
<td style = "text-align: right; ">0.24</td>
<td style = "text-align: right; ">20.0</td>
</tr>
<tr>
<td style = "text-align: right; ">1</td>
<td style = "text-align: right; ">4.0</td>
<td style = "text-align: right; ">0</td>
<td style = "text-align: right; ">0.74</td>
<td style = "text-align: right; ">0.66</td>
<td style = "text-align: right; ">0.73</td>
<td style = "text-align: right; ">0.17</td>
<td style = "text-align: right; ">0.08</td>
<td style = "text-align: right; ">Pumas.FOCEI()</td>
<td style = "text-align: right; ">-0.14</td>
<td style = "text-align: right; ">-0.13</td>
<td style = "text-align: right; ">0.24</td>
<td style = "text-align: right; ">20.0</td>
</tr>
<tr>
<td style = "text-align: right; ">1</td>
<td style = "text-align: right; ">5.0</td>
<td style = "text-align: right; ">0</td>
<td style = "text-align: right; ">0.6</td>
<td style = "text-align: right; ">0.52</td>
<td style = "text-align: right; ">0.58</td>
<td style = "text-align: right; ">0.41</td>
<td style = "text-align: right; ">0.33</td>
<td style = "text-align: right; ">Pumas.FOCEI()</td>
<td style = "text-align: right; ">-0.14</td>
<td style = "text-align: right; ">-0.13</td>
<td style = "text-align: right; ">0.24</td>
<td style = "text-align: right; ">20.0</td>
</tr>
<tr>
<td style = "text-align: right; ">1</td>
<td style = "text-align: right; ">6.0</td>
<td style = "text-align: right; ">0</td>
<td style = "text-align: right; ">0.43</td>
<td style = "text-align: right; ">0.41</td>
<td style = "text-align: right; ">0.46</td>
<td style = "text-align: right; ">-0.65</td>
<td style = "text-align: right; ">-0.72</td>
<td style = "text-align: right; ">Pumas.FOCEI()</td>
<td style = "text-align: right; ">-0.14</td>
<td style = "text-align: right; ">-0.13</td>
<td style = "text-align: right; ">0.24</td>
<td style = "text-align: right; ">20.0</td>
</tr>
<tr>
<td style = "text-align: right; ">1</td>
<td style = "text-align: right; ">7.0</td>
<td style = "text-align: right; ">0</td>
<td style = "text-align: right; ">0.36</td>
<td style = "text-align: right; ">0.32</td>
<td style = "text-align: right; ">0.36</td>
<td style = "text-align: right; ">0.07</td>
<td style = "text-align: right; ">0.01</td>
<td style = "text-align: right; ">Pumas.FOCEI()</td>
<td style = "text-align: right; ">-0.14</td>
<td style = "text-align: right; ">-0.13</td>
<td style = "text-align: right; ">0.24</td>
<td style = "text-align: right; ">20.0</td>
</tr>
</table>
</body>
</html>



<pre class='hljl'>
<span class='hljl-n'>res_inspect_2cmp</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>DataFrame</span><span class='hljl-p'>(</span><span class='hljl-nf'>inspect</span><span class='hljl-p'>(</span><span class='hljl-n'>pkfit_2cmp</span><span class='hljl-p'>))</span><span class='hljl-t'>
</span><span class='hljl-nf'>dropmissing!</span><span class='hljl-p'>(</span><span class='hljl-n'>res_inspect_2cmp</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-nf'>pretty_table</span><span class='hljl-p'>(</span><span class='hljl-nf'>first</span><span class='hljl-p'>(</span><span class='hljl-n'>res_inspect_2cmp</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>10</span><span class='hljl-p'>),</span><span class='hljl-t'> </span><span class='hljl-n'>backend</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:html</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>formatters</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>ft_round</span><span class='hljl-p'>(</span><span class='hljl-ni'>2</span><span class='hljl-p'>,[</span><span class='hljl-ni'>4</span><span class='hljl-p'>,</span><span class='hljl-ni'>5</span><span class='hljl-p'>,</span><span class='hljl-ni'>6</span><span class='hljl-p'>,</span><span class='hljl-ni'>7</span><span class='hljl-p'>,</span><span class='hljl-ni'>8</span><span class='hljl-p'>,</span><span class='hljl-ni'>10</span><span class='hljl-p'>,</span><span class='hljl-ni'>11</span><span class='hljl-p'>,</span><span class='hljl-ni'>12</span><span class='hljl-p'>,</span><span class='hljl-ni'>13</span><span class='hljl-p'>,</span><span class='hljl-ni'>14</span><span class='hljl-p'>]))</span>
</pre>


<pre class="output">
Calculating: predictions, weighted residuals, empirical bayes. Done.
</pre>


<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<style>
table, td, th {
    border-collapse: collapse;
    font-family: sans-serif;
}

td, th {
    border-bottom: 0;
    padding: 4px
}

tr:nth-child(odd) {
    background: #eee;
}

tr:nth-child(even) {
    background: #fff;
}

tr.header {
    background: navy !important;
    color: white;
    font-weight: bold;
}

tr.subheader {
    background: lightgray !important;
    color: black;
}

tr.headerLastRow {
    border-bottom: 2px solid black;
}

th.rowNumber, td.rowNumber {
    text-align: right;
}

</style>
<body>
<table>
<tr class = header>
<th style = "text-align: right; ">id</th>
<th style = "text-align: right; ">time</th>
<th style = "text-align: right; ">evid</th>
<th style = "text-align: right; ">CONC</th>
<th style = "text-align: right; ">CONC_pred</th>
<th style = "text-align: right; ">CONC_ipred</th>
<th style = "text-align: right; ">CONC_wres</th>
<th style = "text-align: right; ">CONC_iwres</th>
<th style = "text-align: right; ">wres_approx</th>
<th style = "text-align: right; ">η_1</th>
<th style = "text-align: right; ">η_2</th>
<th style = "text-align: right; ">η_3</th>
<th style = "text-align: right; ">η_4</th>
<th style = "text-align: right; ">η_5</th>
<th style = "text-align: right; ">DOSE</th>
</tr>
<tr class = "subheader headerLastRow">
<th style = "text-align: right; ">String</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Int64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Pumas.FOCEI</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Int64</th>
</tr>
<tr>
<td style = "text-align: right; ">1</td>
<td style = "text-align: right; ">0.5</td>
<td style = "text-align: right; ">0</td>
<td style = "text-align: right; ">1.16</td>
<td style = "text-align: right; ">1.03</td>
<td style = "text-align: right; ">1.13</td>
<td style = "text-align: right; ">0.48</td>
<td style = "text-align: right; ">0.39</td>
<td style = "text-align: right; ">Pumas.FOCEI()</td>
<td style = "text-align: right; ">-0.2</td>
<td style = "text-align: right; ">-0.07</td>
<td style = "text-align: right; ">0.01</td>
<td style = "text-align: right; ">0.11</td>
<td style = "text-align: right; ">-0.5</td>
<td style = "text-align: right; ">20</td>
</tr>
<tr>
<td style = "text-align: right; ">1</td>
<td style = "text-align: right; ">1.0</td>
<td style = "text-align: right; ">0</td>
<td style = "text-align: right; ">1.37</td>
<td style = "text-align: right; ">1.23</td>
<td style = "text-align: right; ">1.38</td>
<td style = "text-align: right; ">0.01</td>
<td style = "text-align: right; ">-0.16</td>
<td style = "text-align: right; ">Pumas.FOCEI()</td>
<td style = "text-align: right; ">-0.2</td>
<td style = "text-align: right; ">-0.07</td>
<td style = "text-align: right; ">0.01</td>
<td style = "text-align: right; ">0.11</td>
<td style = "text-align: right; ">-0.5</td>
<td style = "text-align: right; ">20</td>
</tr>
<tr>
<td style = "text-align: right; ">1</td>
<td style = "text-align: right; ">1.5</td>
<td style = "text-align: right; ">0</td>
<td style = "text-align: right; ">1.3</td>
<td style = "text-align: right; ">1.17</td>
<td style = "text-align: right; ">1.34</td>
<td style = "text-align: right; ">-0.29</td>
<td style = "text-align: right; ">-0.56</td>
<td style = "text-align: right; ">Pumas.FOCEI()</td>
<td style = "text-align: right; ">-0.2</td>
<td style = "text-align: right; ">-0.07</td>
<td style = "text-align: right; ">0.01</td>
<td style = "text-align: right; ">0.11</td>
<td style = "text-align: right; ">-0.5</td>
<td style = "text-align: right; ">20</td>
</tr>
<tr>
<td style = "text-align: right; ">1</td>
<td style = "text-align: right; ">2.0</td>
<td style = "text-align: right; ">0</td>
<td style = "text-align: right; ">1.19</td>
<td style = "text-align: right; ">1.04</td>
<td style = "text-align: right; ">1.21</td>
<td style = "text-align: right; ">0.1</td>
<td style = "text-align: right; ">-0.25</td>
<td style = "text-align: right; ">Pumas.FOCEI()</td>
<td style = "text-align: right; ">-0.2</td>
<td style = "text-align: right; ">-0.07</td>
<td style = "text-align: right; ">0.01</td>
<td style = "text-align: right; ">0.11</td>
<td style = "text-align: right; ">-0.5</td>
<td style = "text-align: right; ">20</td>
</tr>
<tr>
<td style = "text-align: right; ">1</td>
<td style = "text-align: right; ">2.5</td>
<td style = "text-align: right; ">0</td>
<td style = "text-align: right; ">1.14</td>
<td style = "text-align: right; ">0.9</td>
<td style = "text-align: right; ">1.06</td>
<td style = "text-align: right; ">1.81</td>
<td style = "text-align: right; ">1.4</td>
<td style = "text-align: right; ">Pumas.FOCEI()</td>
<td style = "text-align: right; ">-0.2</td>
<td style = "text-align: right; ">-0.07</td>
<td style = "text-align: right; ">0.01</td>
<td style = "text-align: right; ">0.11</td>
<td style = "text-align: right; ">-0.5</td>
<td style = "text-align: right; ">20</td>
</tr>
<tr>
<td style = "text-align: right; ">1</td>
<td style = "text-align: right; ">3.0</td>
<td style = "text-align: right; ">0</td>
<td style = "text-align: right; ">0.87</td>
<td style = "text-align: right; ">0.78</td>
<td style = "text-align: right; ">0.93</td>
<td style = "text-align: right; ">-0.86</td>
<td style = "text-align: right; ">-1.3</td>
<td style = "text-align: right; ">Pumas.FOCEI()</td>
<td style = "text-align: right; ">-0.2</td>
<td style = "text-align: right; ">-0.07</td>
<td style = "text-align: right; ">0.01</td>
<td style = "text-align: right; ">0.11</td>
<td style = "text-align: right; ">-0.5</td>
<td style = "text-align: right; ">20</td>
</tr>
<tr>
<td style = "text-align: right; ">1</td>
<td style = "text-align: right; ">4.0</td>
<td style = "text-align: right; ">0</td>
<td style = "text-align: right; ">0.74</td>
<td style = "text-align: right; ">0.6</td>
<td style = "text-align: right; ">0.72</td>
<td style = "text-align: right; ">1.03</td>
<td style = "text-align: right; ">0.64</td>
<td style = "text-align: right; ">Pumas.FOCEI()</td>
<td style = "text-align: right; ">-0.2</td>
<td style = "text-align: right; ">-0.07</td>
<td style = "text-align: right; ">0.01</td>
<td style = "text-align: right; ">0.11</td>
<td style = "text-align: right; ">-0.5</td>
<td style = "text-align: right; ">20</td>
</tr>
<tr>
<td style = "text-align: right; ">1</td>
<td style = "text-align: right; ">5.0</td>
<td style = "text-align: right; ">0</td>
<td style = "text-align: right; ">0.6</td>
<td style = "text-align: right; ">0.47</td>
<td style = "text-align: right; ">0.56</td>
<td style = "text-align: right; ">1.64</td>
<td style = "text-align: right; ">1.4</td>
<td style = "text-align: right; ">Pumas.FOCEI()</td>
<td style = "text-align: right; ">-0.2</td>
<td style = "text-align: right; ">-0.07</td>
<td style = "text-align: right; ">0.01</td>
<td style = "text-align: right; ">0.11</td>
<td style = "text-align: right; ">-0.5</td>
<td style = "text-align: right; ">20</td>
</tr>
<tr>
<td style = "text-align: right; ">1</td>
<td style = "text-align: right; ">6.0</td>
<td style = "text-align: right; ">0</td>
<td style = "text-align: right; ">0.43</td>
<td style = "text-align: right; ">0.38</td>
<td style = "text-align: right; ">0.45</td>
<td style = "text-align: right; ">-1.02</td>
<td style = "text-align: right; ">-1.07</td>
<td style = "text-align: right; ">Pumas.FOCEI()</td>
<td style = "text-align: right; ">-0.2</td>
<td style = "text-align: right; ">-0.07</td>
<td style = "text-align: right; ">0.01</td>
<td style = "text-align: right; ">0.11</td>
<td style = "text-align: right; ">-0.5</td>
<td style = "text-align: right; ">20</td>
</tr>
<tr>
<td style = "text-align: right; ">1</td>
<td style = "text-align: right; ">7.0</td>
<td style = "text-align: right; ">0</td>
<td style = "text-align: right; ">0.36</td>
<td style = "text-align: right; ">0.32</td>
<td style = "text-align: right; ">0.37</td>
<td style = "text-align: right; ">-0.26</td>
<td style = "text-align: right; ">-0.13</td>
<td style = "text-align: right; ">Pumas.FOCEI()</td>
<td style = "text-align: right; ">-0.2</td>
<td style = "text-align: right; ">-0.07</td>
<td style = "text-align: right; ">0.01</td>
<td style = "text-align: right; ">0.11</td>
<td style = "text-align: right; ">-0.5</td>
<td style = "text-align: right; ">20</td>
</tr>
</table>
</body>
</html>


<p>Let&#39;s make some plots. <em>Note: These are WIP packages that will be improved over time.</em></p>


<pre class='hljl'>
<span class='hljl-nf'>theme</span><span class='hljl-p'>(</span><span class='hljl-sc'>:wong2</span><span class='hljl-p'>)</span>
</pre>




<pre class='hljl'>
<span class='hljl-k'>function</span><span class='hljl-t'> </span><span class='hljl-nf'>gof</span><span class='hljl-p'>(</span><span class='hljl-n'>res_inspect</span><span class='hljl-p'>)</span><span class='hljl-t'>
  </span><span class='hljl-n'>p1</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>plot</span><span class='hljl-p'>()</span><span class='hljl-t'>
  </span><span class='hljl-nd'>@df</span><span class='hljl-t'> </span><span class='hljl-n'>res_inspect</span><span class='hljl-t'> </span><span class='hljl-nf'>scatter!</span><span class='hljl-p'>(</span><span class='hljl-t'>
      </span><span class='hljl-n'>p1</span><span class='hljl-p'>,</span><span class='hljl-t'>
      </span><span class='hljl-sc'>:CONC_pred</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>:CONC</span><span class='hljl-p'>;</span><span class='hljl-t'>
      </span><span class='hljl-n'>ylabel</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;Observed CTM-Nopain (ng/mL)&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'>
      </span><span class='hljl-n'>xlabel</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;Population Predicted CTM-Nopain (ng/mL)&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'>
      </span><span class='hljl-n'>label</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'>
      </span><span class='hljl-n'>legend</span><span class='hljl-oB'>=</span><span class='hljl-kc'>false</span><span class='hljl-p'>,</span><span class='hljl-t'>
  </span><span class='hljl-p'>)</span><span class='hljl-t'>
  </span><span class='hljl-n'>Plots</span><span class='hljl-oB'>.</span><span class='hljl-nf'>abline!</span><span class='hljl-p'>(</span><span class='hljl-n'>p1</span><span class='hljl-p'>,</span><span class='hljl-t'>  </span><span class='hljl-ni'>1</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>0</span><span class='hljl-p'>;</span><span class='hljl-t'> </span><span class='hljl-n'>primary</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-kc'>false</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>linewidth</span><span class='hljl-oB'>=</span><span class='hljl-ni'>4</span><span class='hljl-p'>)</span><span class='hljl-t'>

  </span><span class='hljl-nd'>@df</span><span class='hljl-t'> </span><span class='hljl-n'>res_inspect</span><span class='hljl-t'> </span><span class='hljl-nf'>plot!</span><span class='hljl-p'>(</span><span class='hljl-t'>
   </span><span class='hljl-n'>p1</span><span class='hljl-p'>,</span><span class='hljl-t'>
   </span><span class='hljl-sc'>:CONC_pred</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>:CONC</span><span class='hljl-p'>;</span><span class='hljl-t'>
   </span><span class='hljl-n'>seriestype</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:Loess</span><span class='hljl-p'>,</span><span class='hljl-t'>
   </span><span class='hljl-n'>linewidth</span><span class='hljl-oB'>=</span><span class='hljl-ni'>4</span><span class='hljl-t'>
  </span><span class='hljl-p'>)</span><span class='hljl-t'>

  </span><span class='hljl-cs'>#</span><span class='hljl-t'>
  </span><span class='hljl-n'>p2</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>plot</span><span class='hljl-p'>()</span><span class='hljl-t'>
  </span><span class='hljl-nd'>@df</span><span class='hljl-t'> </span><span class='hljl-n'>res_inspect</span><span class='hljl-t'> </span><span class='hljl-nf'>scatter!</span><span class='hljl-p'>(</span><span class='hljl-t'>
      </span><span class='hljl-n'>p2</span><span class='hljl-p'>,</span><span class='hljl-t'>
      </span><span class='hljl-sc'>:CONC_ipred</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>:CONC</span><span class='hljl-p'>;</span><span class='hljl-t'>
      </span><span class='hljl-n'>ylabel</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;Observed CTM-Nopain (ng/mL)&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'>
      </span><span class='hljl-n'>xlabel</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;Individual Predicted CTM-Nopain (ng/mL)&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'>
      </span><span class='hljl-n'>label</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'>
      </span><span class='hljl-n'>legend</span><span class='hljl-oB'>=</span><span class='hljl-kc'>false</span><span class='hljl-p'>,</span><span class='hljl-t'>
  </span><span class='hljl-p'>)</span><span class='hljl-t'>
  </span><span class='hljl-n'>Plots</span><span class='hljl-oB'>.</span><span class='hljl-nf'>abline!</span><span class='hljl-p'>(</span><span class='hljl-n'>p2</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>1</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>0</span><span class='hljl-p'>;</span><span class='hljl-t'> </span><span class='hljl-n'>primary</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-kc'>false</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>linewidth</span><span class='hljl-oB'>=</span><span class='hljl-ni'>4</span><span class='hljl-p'>)</span><span class='hljl-t'>

  </span><span class='hljl-nd'>@df</span><span class='hljl-t'> </span><span class='hljl-n'>res_inspect</span><span class='hljl-t'> </span><span class='hljl-nf'>plot!</span><span class='hljl-p'>(</span><span class='hljl-t'>
   </span><span class='hljl-n'>p2</span><span class='hljl-p'>,</span><span class='hljl-t'>
   </span><span class='hljl-sc'>:CONC_ipred</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>:CONC</span><span class='hljl-p'>;</span><span class='hljl-t'>
   </span><span class='hljl-n'>seriestype</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:Loess</span><span class='hljl-p'>,</span><span class='hljl-t'>
   </span><span class='hljl-n'>linewidth</span><span class='hljl-oB'>=</span><span class='hljl-ni'>4</span><span class='hljl-t'>
  </span><span class='hljl-p'>)</span><span class='hljl-t'>

  </span><span class='hljl-cs'>#</span><span class='hljl-t'>
  </span><span class='hljl-n'>p3</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>plot</span><span class='hljl-p'>()</span><span class='hljl-t'>
  </span><span class='hljl-nd'>@df</span><span class='hljl-t'> </span><span class='hljl-n'>res_inspect</span><span class='hljl-t'> </span><span class='hljl-nf'>scatter!</span><span class='hljl-p'>(</span><span class='hljl-t'>
      </span><span class='hljl-n'>p3</span><span class='hljl-p'>,</span><span class='hljl-t'>
      </span><span class='hljl-sc'>:time</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>:CONC_wres</span><span class='hljl-p'>;</span><span class='hljl-t'>
      </span><span class='hljl-n'>xlabel</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;Time (h)&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'>
      </span><span class='hljl-n'>ylabel</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;Conditional Weighted Residuals&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'>
       </span><span class='hljl-n'>legend</span><span class='hljl-oB'>=</span><span class='hljl-kc'>false</span><span class='hljl-t'>
  </span><span class='hljl-p'>)</span><span class='hljl-t'>
  </span><span class='hljl-n'>Plots</span><span class='hljl-oB'>.</span><span class='hljl-nf'>abline!</span><span class='hljl-p'>(</span><span class='hljl-n'>p3</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>0</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>0</span><span class='hljl-p'>;</span><span class='hljl-t'> </span><span class='hljl-n'>primary</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-kc'>false</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>linewidth</span><span class='hljl-oB'>=</span><span class='hljl-ni'>4</span><span class='hljl-p'>)</span><span class='hljl-t'>
  </span><span class='hljl-nd'>@df</span><span class='hljl-t'> </span><span class='hljl-n'>res_inspect</span><span class='hljl-t'> </span><span class='hljl-nf'>plot!</span><span class='hljl-p'>(</span><span class='hljl-t'>
   </span><span class='hljl-n'>p3</span><span class='hljl-p'>,</span><span class='hljl-t'>
   </span><span class='hljl-sc'>:time</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>:CONC_wres</span><span class='hljl-p'>;</span><span class='hljl-t'>
   </span><span class='hljl-n'>seriestype</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:Loess</span><span class='hljl-p'>,</span><span class='hljl-t'>
   </span><span class='hljl-n'>linewidth</span><span class='hljl-oB'>=</span><span class='hljl-ni'>4</span><span class='hljl-t'>
  </span><span class='hljl-p'>)</span><span class='hljl-t'>
  </span><span class='hljl-cs'>#</span><span class='hljl-t'>
  </span><span class='hljl-n'>p4</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>plot</span><span class='hljl-p'>()</span><span class='hljl-t'>
  </span><span class='hljl-nd'>@df</span><span class='hljl-t'> </span><span class='hljl-n'>res_inspect</span><span class='hljl-t'> </span><span class='hljl-nf'>scatter!</span><span class='hljl-p'>(</span><span class='hljl-t'>
      </span><span class='hljl-n'>p4</span><span class='hljl-p'>,</span><span class='hljl-t'>
      </span><span class='hljl-sc'>:CONC_pred</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>:CONC_wres</span><span class='hljl-p'>,</span><span class='hljl-t'>
      </span><span class='hljl-n'>xlabel</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;Population Predicted CTM-Nopain (ng/mL))&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'>
      </span><span class='hljl-n'>ylabel</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;Conditional Weighted Residuals&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'>
      </span><span class='hljl-n'>legend</span><span class='hljl-oB'>=</span><span class='hljl-kc'>false</span><span class='hljl-t'>
  </span><span class='hljl-p'>)</span><span class='hljl-t'>
  </span><span class='hljl-n'>Plots</span><span class='hljl-oB'>.</span><span class='hljl-nf'>abline!</span><span class='hljl-p'>(</span><span class='hljl-n'>p4</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>0</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>0</span><span class='hljl-p'>;</span><span class='hljl-t'> </span><span class='hljl-n'>primary</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-kc'>false</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>linewidth</span><span class='hljl-oB'>=</span><span class='hljl-ni'>4</span><span class='hljl-p'>)</span><span class='hljl-t'>
  </span><span class='hljl-nd'>@df</span><span class='hljl-t'> </span><span class='hljl-n'>res_inspect</span><span class='hljl-t'> </span><span class='hljl-nf'>plot!</span><span class='hljl-p'>(</span><span class='hljl-t'>
   </span><span class='hljl-n'>p4</span><span class='hljl-p'>,</span><span class='hljl-t'>
   </span><span class='hljl-sc'>:CONC_pred</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>:CONC_wres</span><span class='hljl-p'>;</span><span class='hljl-t'>
   </span><span class='hljl-n'>seriestype</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:Loess</span><span class='hljl-p'>,</span><span class='hljl-t'>
   </span><span class='hljl-n'>linewidth</span><span class='hljl-oB'>=</span><span class='hljl-ni'>4</span><span class='hljl-t'>
  </span><span class='hljl-p'>)</span><span class='hljl-t'>

  </span><span class='hljl-k'>return</span><span class='hljl-t'> </span><span class='hljl-nf'>plot</span><span class='hljl-p'>(</span><span class='hljl-n'>p1</span><span class='hljl-p'>,</span><span class='hljl-n'>p2</span><span class='hljl-p'>,</span><span class='hljl-n'>p3</span><span class='hljl-p'>,</span><span class='hljl-n'>p4</span><span class='hljl-p'>;</span><span class='hljl-t'> </span><span class='hljl-n'>size</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>(</span><span class='hljl-ni'>1000</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>1000</span><span class='hljl-p'>))</span><span class='hljl-t'>
</span><span class='hljl-k'>end</span>
</pre>


<pre class="output">
gof &#40;generic function with 1 method&#41;
</pre>




<pre class='hljl'>
<span class='hljl-n'>gof_1cmp</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>gof</span><span class='hljl-p'>(</span><span class='hljl-n'>res_inspect_1cmp</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-cs'>#savefig(&quot;./assets/gof1cmt.png&quot;)</span>
</pre>


<p><img src="./assets/gof1cmt.png" alt="Plot gof1cmt" /></p>



<pre class='hljl'>
<span class='hljl-n'>gof_2cmp</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>gof</span><span class='hljl-p'>(</span><span class='hljl-n'>res_inspect_2cmp</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-cs'>#savefig(&quot;./assets/gof2cmt.png&quot;)</span>
</pre>


<p><img src="./assets/gof2cmt.png" alt="Plot gof2cmt" /></p>
<p>These plots clearly indicate that the 2 compartment model is a better fit compared to the one compartment model. We can look at selected sample of individaul plots.</p>



<pre class='hljl'>
<span class='hljl-k'>function</span><span class='hljl-t'> </span><span class='hljl-nf'>sample_df</span><span class='hljl-p'>(</span><span class='hljl-n'>df</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>nsamples</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-n'>gdf</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>groupby</span><span class='hljl-p'>(</span><span class='hljl-n'>df</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>:id</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-n'>sample_groups</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>sample</span><span class='hljl-p'>(</span><span class='hljl-ni'>1</span><span class='hljl-oB'>:</span><span class='hljl-nf'>length</span><span class='hljl-p'>(</span><span class='hljl-n'>gdf</span><span class='hljl-p'>),</span><span class='hljl-t'> </span><span class='hljl-n'>nsamples</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>replace</span><span class='hljl-oB'>=</span><span class='hljl-kc'>false</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-n'>resampled</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>reduce</span><span class='hljl-p'>(</span><span class='hljl-n'>vcat</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-p'>[</span><span class='hljl-n'>gdf</span><span class='hljl-p'>[</span><span class='hljl-n'>i</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-k'>for</span><span class='hljl-t'> </span><span class='hljl-n'>i</span><span class='hljl-t'> </span><span class='hljl-kp'>in</span><span class='hljl-t'> </span><span class='hljl-n'>sample_groups</span><span class='hljl-p'>])</span><span class='hljl-t'>
    </span><span class='hljl-k'>return</span><span class='hljl-t'> </span><span class='hljl-n'>resampled</span><span class='hljl-t'>
</span><span class='hljl-k'>end</span><span class='hljl-t'>
</span><span class='hljl-n'>Random</span><span class='hljl-oB'>.</span><span class='hljl-nf'>seed!</span><span class='hljl-p'>(</span><span class='hljl-ni'>1234</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-n'>res_inspect_2cmp_sampled</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>sample_df</span><span class='hljl-p'>(</span><span class='hljl-n'>res_inspect_2cmp</span><span class='hljl-p'>,</span><span class='hljl-ni'>12</span><span class='hljl-p'>)</span>
</pre>




<pre class='hljl'>
<span class='hljl-nf'>plot_grouped</span><span class='hljl-p'>(</span><span class='hljl-t'>
    </span><span class='hljl-nf'>groupby</span><span class='hljl-p'>(</span><span class='hljl-n'>res_inspect_2cmp_sampled</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>:id</span><span class='hljl-p'>);</span><span class='hljl-t'>
    </span><span class='hljl-cs'># needs to be a large size for the plots to</span><span class='hljl-t'>
    </span><span class='hljl-cs'># be visible.  Try to maintain a square aspect</span><span class='hljl-t'>
    </span><span class='hljl-cs'># ratio.</span><span class='hljl-t'>
    </span><span class='hljl-n'>size</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>(</span><span class='hljl-ni'>2000</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>2000</span><span class='hljl-p'>),</span><span class='hljl-t'>
    </span><span class='hljl-cs'># we don&#39;t need a legend</span><span class='hljl-t'>
    </span><span class='hljl-n'>legend</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:none</span><span class='hljl-p'>,</span><span class='hljl-t'>
    </span><span class='hljl-cs'># link y axes together</span><span class='hljl-t'>
    </span><span class='hljl-n'>link</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:y</span><span class='hljl-p'>,</span><span class='hljl-t'>
    </span><span class='hljl-cs'># the figures should be laid out tightly</span><span class='hljl-t'>
    </span><span class='hljl-n'>margin</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>0</span><span class='hljl-n'>Plots</span><span class='hljl-oB'>.</span><span class='hljl-n'>px</span><span class='hljl-p'>,</span><span class='hljl-t'>
    </span><span class='hljl-cs'># these fontsizes are based on personal preference,</span><span class='hljl-t'>
    </span><span class='hljl-cs'># but should be fairly large, so that they can be</span><span class='hljl-t'>
    </span><span class='hljl-cs'># seen in PDFs.</span><span class='hljl-t'>
    </span><span class='hljl-n'>tickfontsize</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>14</span><span class='hljl-p'>,</span><span class='hljl-t'>
    </span><span class='hljl-n'>titlefontsize</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>15</span><span class='hljl-t'>
</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-k'>do</span><span class='hljl-t'> </span><span class='hljl-n'>subdf</span><span class='hljl-t'>
    </span><span class='hljl-nd'>@df</span><span class='hljl-t'> </span><span class='hljl-n'>subdf</span><span class='hljl-t'> </span><span class='hljl-nf'>scatter</span><span class='hljl-p'>(</span><span class='hljl-sc'>:time</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>:CONC</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>color</span><span class='hljl-oB'>=:</span><span class='hljl-n'>black</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>markersize</span><span class='hljl-oB'>=</span><span class='hljl-ni'>8</span><span class='hljl-p'>,</span><span class='hljl-t'>
    </span><span class='hljl-n'>xlabel</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;Time (hours)&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>ylabel</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;Concentration (ng</span><span class='hljl-se'>\\</span><span class='hljl-s'>/mL)&quot;</span><span class='hljl-t'> </span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-nd'>@df</span><span class='hljl-t'> </span><span class='hljl-n'>subdf</span><span class='hljl-t'> </span><span class='hljl-nf'>plot!</span><span class='hljl-p'>(</span><span class='hljl-sc'>:time</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>:CONC_pred</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>color</span><span class='hljl-oB'>=:</span><span class='hljl-n'>red</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>linewidth</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-ni'>4</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-nd'>@df</span><span class='hljl-t'> </span><span class='hljl-n'>subdf</span><span class='hljl-t'> </span><span class='hljl-nf'>plot!</span><span class='hljl-p'>(</span><span class='hljl-sc'>:time</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>:CONC_ipred</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>color</span><span class='hljl-oB'>=:</span><span class='hljl-n'>blue</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>linewidth</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-ni'>4</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-k'>end</span><span class='hljl-t'>
</span><span class='hljl-cs'>#savefig(&quot;./assets/indpreds1.png&quot;)</span>
</pre>


<p><img src="./assets/indpreds1.png" alt="Plot indpreds1" /></p>



<pre class='hljl'>
<span class='hljl-n'>data4_etacov</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>select</span><span class='hljl-p'>(</span><span class='hljl-n'>res_inspect_2cmp</span><span class='hljl-p'>,[</span><span class='hljl-s'>&quot;η_1&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;η_2&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;η_3&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;η_4&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;η_5&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;DOSE&quot;</span><span class='hljl-p'>])</span><span class='hljl-t'>
</span><span class='hljl-n'>data4_etacov</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>stack</span><span class='hljl-p'>(</span><span class='hljl-n'>data4_etacov</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-p'>[</span><span class='hljl-s'>&quot;η_1&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;η_2&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;η_3&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;η_4&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;η_5&quot;</span><span class='hljl-p'>],</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;DOSE&quot;</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-n'>data4_etacov</span><span class='hljl-p'>[</span><span class='hljl-oB'>!</span><span class='hljl-p'>,</span><span class='hljl-oB'>:</span><span class='hljl-n'>variable</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-oB'>.=</span><span class='hljl-t'> </span><span class='hljl-n'>string</span><span class='hljl-oB'>.</span><span class='hljl-p'>(</span><span class='hljl-n'>data4_etacov</span><span class='hljl-oB'>.</span><span class='hljl-n'>variable</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-nd'>@df</span><span class='hljl-t'> </span><span class='hljl-n'>data4_etacov</span><span class='hljl-t'> </span><span class='hljl-nf'>groupedviolin</span><span class='hljl-p'>(</span><span class='hljl-sc'>:variable</span><span class='hljl-p'>,</span><span class='hljl-oB'>:</span><span class='hljl-n'>value</span><span class='hljl-p'>,</span><span class='hljl-t'>
                              </span><span class='hljl-n'>group</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:DOSE</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>alpha</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-nfB'>0.5</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-nd'>@df</span><span class='hljl-t'> </span><span class='hljl-n'>data4_etacov</span><span class='hljl-t'> </span><span class='hljl-nf'>groupedboxplot!</span><span class='hljl-p'>(</span><span class='hljl-sc'>:variable</span><span class='hljl-p'>,</span><span class='hljl-oB'>:</span><span class='hljl-n'>value</span><span class='hljl-p'>,</span><span class='hljl-t'>
                              </span><span class='hljl-n'>group</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:DOSE</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>alpha</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-nfB'>0.5</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>label</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-s'>&quot;&quot;</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-n'>Plots</span><span class='hljl-oB'>.</span><span class='hljl-nf'>abline!</span><span class='hljl-p'>(</span><span class='hljl-ni'>0</span><span class='hljl-p'>,</span><span class='hljl-ni'>0</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>linewidth</span><span class='hljl-oB'>=</span><span class='hljl-ni'>4</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>color</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;black&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'>
              </span><span class='hljl-n'>size</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>(</span><span class='hljl-ni'>1000</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>1000</span><span class='hljl-p'>),</span><span class='hljl-t'>
              </span><span class='hljl-n'>xlabel</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;η&#39;s&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>ylabel</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;η_values&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>legendtitle</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;Dose (mg)&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'>
              </span><span class='hljl-n'>guidefontsize</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>22</span><span class='hljl-p'>,</span><span class='hljl-t'>
              </span><span class='hljl-n'>tickfontsize</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-ni'>14</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>label</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-s'>&quot;&quot;</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-cs'>#savefig(&quot;./assets/etacov1.png&quot;)</span>
</pre>


<p><img src="./assets/etacov1.png" alt="Plot etacov1" /></p>
<p>Clearly,our guess at <code>tvka</code> seems off-target. Let&#39;s try and estimate <code>tvka</code> instead of fixing it to <code>2</code></p>


<pre class='hljl'>
<span class='hljl-n'>pkfit_2cmp_unfix_ka</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>fit</span><span class='hljl-p'>(</span><span class='hljl-n'>pk_2cmp</span><span class='hljl-p'>,</span><span class='hljl-t'>
                 </span><span class='hljl-n'>pkpain_noplb</span><span class='hljl-p'>,</span><span class='hljl-t'>
                 </span><span class='hljl-nf'>init_param</span><span class='hljl-p'>(</span><span class='hljl-n'>pk_2cmp</span><span class='hljl-p'>),</span><span class='hljl-t'>
                 </span><span class='hljl-n'>Pumas</span><span class='hljl-oB'>.</span><span class='hljl-nf'>FOCEI</span><span class='hljl-p'>(),</span><span class='hljl-t'> </span><span class='hljl-n'>ensemblealg</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>EnsembleThreads</span><span class='hljl-p'>())</span>
</pre>




<pre class='hljl'>
<span class='hljl-nf'>pretty_table</span><span class='hljl-p'>(</span><span class='hljl-nf'>coeftable</span><span class='hljl-p'>(</span><span class='hljl-nf'>infer</span><span class='hljl-p'>(</span><span class='hljl-n'>pkfit_2cmp_unfix_ka</span><span class='hljl-p'>)),</span><span class='hljl-t'> </span><span class='hljl-n'>backend</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:html</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>formatters</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>ft_round</span><span class='hljl-p'>(</span><span class='hljl-ni'>2</span><span class='hljl-p'>,[</span><span class='hljl-ni'>2</span><span class='hljl-p'>,</span><span class='hljl-ni'>3</span><span class='hljl-p'>,</span><span class='hljl-ni'>4</span><span class='hljl-p'>,</span><span class='hljl-ni'>5</span><span class='hljl-p'>]))</span>
</pre>


<pre class="output">
Calculating: variance-covariance matrix. Done.
</pre>


<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<style>
table, td, th {
    border-collapse: collapse;
    font-family: sans-serif;
}

td, th {
    border-bottom: 0;
    padding: 4px
}

tr:nth-child(odd) {
    background: #eee;
}

tr:nth-child(even) {
    background: #fff;
}

tr.header {
    background: navy !important;
    color: white;
    font-weight: bold;
}

tr.subheader {
    background: lightgray !important;
    color: black;
}

tr.headerLastRow {
    border-bottom: 2px solid black;
}

th.rowNumber, td.rowNumber {
    text-align: right;
}

</style>
<body>
<table>
<tr class = header>
<th style = "text-align: right; ">parameter</th>
<th style = "text-align: right; ">estimate</th>
<th style = "text-align: right; ">se</th>
<th style = "text-align: right; ">ci_lower</th>
<th style = "text-align: right; ">ci_upper</th>
</tr>
<tr class = "subheader headerLastRow">
<th style = "text-align: right; ">String</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Float64</th>
</tr>
<tr>
<td style = "text-align: right; ">tvcl</td>
<td style = "text-align: right; ">2.64</td>
<td style = "text-align: right; ">0.11</td>
<td style = "text-align: right; ">2.43</td>
<td style = "text-align: right; ">2.85</td>
</tr>
<tr>
<td style = "text-align: right; ">tvv</td>
<td style = "text-align: right; ">11.36</td>
<td style = "text-align: right; ">0.27</td>
<td style = "text-align: right; ">10.83</td>
<td style = "text-align: right; ">11.89</td>
</tr>
<tr>
<td style = "text-align: right; ">tvvp</td>
<td style = "text-align: right; ">8.2</td>
<td style = "text-align: right; ">1.08</td>
<td style = "text-align: right; ">6.07</td>
<td style = "text-align: right; ">10.32</td>
</tr>
<tr>
<td style = "text-align: right; ">tvq</td>
<td style = "text-align: right; ">1.32</td>
<td style = "text-align: right; ">0.08</td>
<td style = "text-align: right; ">1.17</td>
<td style = "text-align: right; ">1.47</td>
</tr>
<tr>
<td style = "text-align: right; ">tvka</td>
<td style = "text-align: right; ">4.86</td>
<td style = "text-align: right; ">0.34</td>
<td style = "text-align: right; ">4.19</td>
<td style = "text-align: right; ">5.52</td>
</tr>
<tr>
<td style = "text-align: right; ">Ω₁,₁</td>
<td style = "text-align: right; ">0.13</td>
<td style = "text-align: right; ">0.02</td>
<td style = "text-align: right; ">0.09</td>
<td style = "text-align: right; ">0.17</td>
</tr>
<tr>
<td style = "text-align: right; ">Ω₂,₂</td>
<td style = "text-align: right; ">0.06</td>
<td style = "text-align: right; ">0.01</td>
<td style = "text-align: right; ">0.05</td>
<td style = "text-align: right; ">0.07</td>
</tr>
<tr>
<td style = "text-align: right; ">Ω₃,₃</td>
<td style = "text-align: right; ">0.41</td>
<td style = "text-align: right; ">0.08</td>
<td style = "text-align: right; ">0.24</td>
<td style = "text-align: right; ">0.57</td>
</tr>
<tr>
<td style = "text-align: right; ">Ω₄,₄</td>
<td style = "text-align: right; ">0.14</td>
<td style = "text-align: right; ">0.06</td>
<td style = "text-align: right; ">0.02</td>
<td style = "text-align: right; ">0.26</td>
</tr>
<tr>
<td style = "text-align: right; ">Ω₅,₅</td>
<td style = "text-align: right; ">0.25</td>
<td style = "text-align: right; ">0.05</td>
<td style = "text-align: right; ">0.16</td>
<td style = "text-align: right; ">0.35</td>
</tr>
<tr>
<td style = "text-align: right; ">σ_p</td>
<td style = "text-align: right; ">0.05</td>
<td style = "text-align: right; ">0.0</td>
<td style = "text-align: right; ">0.05</td>
<td style = "text-align: right; ">0.05</td>
</tr>
</table>
</body>
</html>



<pre class='hljl'>
<span class='hljl-nd'>@pipe</span><span class='hljl-t'> </span><span class='hljl-nf'>leftjoin</span><span class='hljl-p'>(</span><span class='hljl-nf'>coeftable</span><span class='hljl-p'>(</span><span class='hljl-n'>pkfit_2cmp</span><span class='hljl-p'>),</span><span class='hljl-t'>
               </span><span class='hljl-nf'>coeftable</span><span class='hljl-p'>(</span><span class='hljl-n'>pkfit_2cmp_unfix_ka</span><span class='hljl-p'>),</span><span class='hljl-t'> </span><span class='hljl-n'>on</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:parameter</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>makeunique</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-kc'>true</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-oB'>|&gt;</span><span class='hljl-t'>
  </span><span class='hljl-nf'>rename!</span><span class='hljl-p'>(</span><span class='hljl-n'>_</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>:estimate</span><span class='hljl-t'> </span><span class='hljl-oB'>=&gt;</span><span class='hljl-t'> </span><span class='hljl-sc'>:pk2cmp</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>:estimate_1</span><span class='hljl-t'> </span><span class='hljl-oB'>=&gt;</span><span class='hljl-t'> </span><span class='hljl-sc'>:pk2cmp_unfix_ka</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-oB'>|&gt;</span><span class='hljl-t'>
  </span><span class='hljl-nf'>pretty_table</span><span class='hljl-p'>(</span><span class='hljl-n'>_</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>backend</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:html</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>formatters</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>ft_round</span><span class='hljl-p'>(</span><span class='hljl-ni'>2</span><span class='hljl-p'>,[</span><span class='hljl-ni'>2</span><span class='hljl-p'>,</span><span class='hljl-ni'>3</span><span class='hljl-p'>]))</span>
</pre>



<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<style>
table, td, th {
    border-collapse: collapse;
    font-family: sans-serif;
}

td, th {
    border-bottom: 0;
    padding: 4px
}

tr:nth-child(odd) {
    background: #eee;
}

tr:nth-child(even) {
    background: #fff;
}

tr.header {
    background: navy !important;
    color: white;
    font-weight: bold;
}

tr.subheader {
    background: lightgray !important;
    color: black;
}

tr.headerLastRow {
    border-bottom: 2px solid black;
}

th.rowNumber, td.rowNumber {
    text-align: right;
}

</style>
<body>
<table>
<tr class = header>
<th style = "text-align: right; ">parameter</th>
<th style = "text-align: right; ">pk2cmp</th>
<th style = "text-align: right; ">pk2cmp_unfix_ka</th>
</tr>
<tr class = "subheader headerLastRow">
<th style = "text-align: right; ">String</th>
<th style = "text-align: right; ">Float64</th>
<th style = "text-align: right; ">Union{Missing, Float64}</th>
</tr>
<tr>
<td style = "text-align: right; ">tvcl</td>
<td style = "text-align: right; ">2.85</td>
<td style = "text-align: right; ">2.64</td>
</tr>
<tr>
<td style = "text-align: right; ">tvv</td>
<td style = "text-align: right; ">10.99</td>
<td style = "text-align: right; ">11.36</td>
</tr>
<tr>
<td style = "text-align: right; ">tvvp</td>
<td style = "text-align: right; ">5.05</td>
<td style = "text-align: right; ">8.2</td>
</tr>
<tr>
<td style = "text-align: right; ">tvq</td>
<td style = "text-align: right; ">1.53</td>
<td style = "text-align: right; ">1.32</td>
</tr>
<tr>
<td style = "text-align: right; ">tvka</td>
<td style = "text-align: right; ">2.0</td>
<td style = "text-align: right; ">4.86</td>
</tr>
<tr>
<td style = "text-align: right; ">Ω₁,₁</td>
<td style = "text-align: right; ">0.1</td>
<td style = "text-align: right; ">0.13</td>
</tr>
<tr>
<td style = "text-align: right; ">Ω₂,₂</td>
<td style = "text-align: right; ">0.06</td>
<td style = "text-align: right; ">0.06</td>
</tr>
<tr>
<td style = "text-align: right; ">Ω₃,₃</td>
<td style = "text-align: right; ">1.13</td>
<td style = "text-align: right; ">0.41</td>
</tr>
<tr>
<td style = "text-align: right; ">Ω₄,₄</td>
<td style = "text-align: right; ">0.46</td>
<td style = "text-align: right; ">0.14</td>
</tr>
<tr>
<td style = "text-align: right; ">Ω₅,₅</td>
<td style = "text-align: right; ">0.24</td>
<td style = "text-align: right; ">0.25</td>
</tr>
<tr>
<td style = "text-align: right; ">σ_p</td>
<td style = "text-align: right; ">0.05</td>
<td style = "text-align: right; ">0.05</td>
</tr>
</table>
</body>
</html>


<p>Let&#39;s revaluate the goodness of fits and η distribution plots.</p>
<p>Not much change in the general <code>gof</code> plots</p>



<pre class='hljl'>
<span class='hljl-n'>res_inspect_2cmp_unfix_ka</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>DataFrame</span><span class='hljl-p'>(</span><span class='hljl-nf'>inspect</span><span class='hljl-p'>(</span><span class='hljl-n'>pkfit_2cmp_unfix_ka</span><span class='hljl-p'>))</span><span class='hljl-t'>
</span><span class='hljl-nf'>gof</span><span class='hljl-p'>(</span><span class='hljl-n'>res_inspect_2cmp_unfix_ka</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-cs'>#savefig(&quot;./assets/gof2ka.png&quot;)</span>
</pre>


<p><img src="./assets/gof2ka.png" alt="Plot gofka" /></p>
<p>But you can see a huge improvement in the <code>ηka</code> distribution which is now centered around zero</p>



<pre class='hljl'>
<span class='hljl-n'>data4_etacov</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>select</span><span class='hljl-p'>(</span><span class='hljl-n'>res_inspect_2cmp_unfix_ka</span><span class='hljl-p'>,[</span><span class='hljl-s'>&quot;η_1&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;η_2&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;η_3&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;η_4&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;η_5&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;DOSE&quot;</span><span class='hljl-p'>])</span><span class='hljl-t'>
</span><span class='hljl-n'>data4_etacov</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>stack</span><span class='hljl-p'>(</span><span class='hljl-n'>data4_etacov</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-p'>[</span><span class='hljl-s'>&quot;η_1&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;η_2&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;η_3&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;η_4&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;η_5&quot;</span><span class='hljl-p'>],</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;DOSE&quot;</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-n'>data4_etacov</span><span class='hljl-p'>[</span><span class='hljl-oB'>!</span><span class='hljl-p'>,</span><span class='hljl-oB'>:</span><span class='hljl-n'>variable</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-oB'>.=</span><span class='hljl-t'> </span><span class='hljl-n'>string</span><span class='hljl-oB'>.</span><span class='hljl-p'>(</span><span class='hljl-n'>data4_etacov</span><span class='hljl-oB'>.</span><span class='hljl-n'>variable</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-nd'>@df</span><span class='hljl-t'> </span><span class='hljl-n'>data4_etacov</span><span class='hljl-t'> </span><span class='hljl-nf'>groupedviolin</span><span class='hljl-p'>(</span><span class='hljl-sc'>:variable</span><span class='hljl-p'>,</span><span class='hljl-oB'>:</span><span class='hljl-n'>value</span><span class='hljl-p'>,</span><span class='hljl-t'>
                              </span><span class='hljl-n'>group</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:DOSE</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>alpha</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-nfB'>0.5</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-nd'>@df</span><span class='hljl-t'> </span><span class='hljl-n'>data4_etacov</span><span class='hljl-t'> </span><span class='hljl-nf'>groupedboxplot!</span><span class='hljl-p'>(</span><span class='hljl-sc'>:variable</span><span class='hljl-p'>,</span><span class='hljl-oB'>:</span><span class='hljl-n'>value</span><span class='hljl-p'>,</span><span class='hljl-t'>
                              </span><span class='hljl-n'>group</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:DOSE</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>alpha</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-nfB'>0.5</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>label</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-s'>&quot;&quot;</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-n'>Plots</span><span class='hljl-oB'>.</span><span class='hljl-nf'>abline!</span><span class='hljl-p'>(</span><span class='hljl-ni'>0</span><span class='hljl-p'>,</span><span class='hljl-ni'>0</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>linewidth</span><span class='hljl-oB'>=</span><span class='hljl-ni'>4</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>color</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;black&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'>
              </span><span class='hljl-n'>size</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>(</span><span class='hljl-ni'>1000</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>1000</span><span class='hljl-p'>),</span><span class='hljl-t'>
              </span><span class='hljl-n'>xlabel</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;η&#39;s&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>ylabel</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;η_values&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>legendtitle</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;Dose (mg)&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'>
              </span><span class='hljl-n'>guidefontsize</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>22</span><span class='hljl-p'>,</span><span class='hljl-t'>
              </span><span class='hljl-n'>tickfontsize</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-ni'>14</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>label</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-s'>&quot;&quot;</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-cs'>#savefig(&quot;./assets/etacov2.png&quot;)</span>
</pre>


<p><img src="./assets/etacov2.png" alt="Plot etacov2" /></p>
<p>Finally looking at some individual plots</p>



<pre class='hljl'>
<span class='hljl-n'>Random</span><span class='hljl-oB'>.</span><span class='hljl-nf'>seed!</span><span class='hljl-p'>(</span><span class='hljl-ni'>1234</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-n'>res_inspect_2cmp_unfixka_sampled</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>sample_df</span><span class='hljl-p'>(</span><span class='hljl-n'>res_inspect_2cmp_unfix_ka</span><span class='hljl-p'>,</span><span class='hljl-ni'>12</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-nf'>plot_grouped</span><span class='hljl-p'>(</span><span class='hljl-t'>
    </span><span class='hljl-nf'>groupby</span><span class='hljl-p'>(</span><span class='hljl-n'>res_inspect_2cmp_unfixka_sampled</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>:id</span><span class='hljl-p'>);</span><span class='hljl-t'>
    </span><span class='hljl-cs'># needs to be a large size for the plots to</span><span class='hljl-t'>
    </span><span class='hljl-cs'># be visible.  Try to maintain a square aspect</span><span class='hljl-t'>
    </span><span class='hljl-cs'># ratio.</span><span class='hljl-t'>
    </span><span class='hljl-n'>size</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>(</span><span class='hljl-ni'>2000</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>2000</span><span class='hljl-p'>),</span><span class='hljl-t'>
    </span><span class='hljl-cs'># we don&#39;t need a legend</span><span class='hljl-t'>
    </span><span class='hljl-n'>legend</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:none</span><span class='hljl-p'>,</span><span class='hljl-t'>
    </span><span class='hljl-cs'># link y axes together</span><span class='hljl-t'>
    </span><span class='hljl-n'>link</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:y</span><span class='hljl-p'>,</span><span class='hljl-t'>
    </span><span class='hljl-cs'># the figures should be laid out tightly</span><span class='hljl-t'>
    </span><span class='hljl-n'>margin</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>0</span><span class='hljl-n'>Plots</span><span class='hljl-oB'>.</span><span class='hljl-n'>px</span><span class='hljl-p'>,</span><span class='hljl-t'>
    </span><span class='hljl-cs'># these fontsizes are based on personal preference,</span><span class='hljl-t'>
    </span><span class='hljl-cs'># but should be fairly large, so that they can be</span><span class='hljl-t'>
    </span><span class='hljl-cs'># seen in PDFs.</span><span class='hljl-t'>
    </span><span class='hljl-n'>tickfontsize</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>14</span><span class='hljl-p'>,</span><span class='hljl-t'>
    </span><span class='hljl-n'>titlefontsize</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>15</span><span class='hljl-t'>
</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-k'>do</span><span class='hljl-t'> </span><span class='hljl-n'>subdf</span><span class='hljl-t'>
    </span><span class='hljl-nd'>@df</span><span class='hljl-t'> </span><span class='hljl-n'>subdf</span><span class='hljl-t'> </span><span class='hljl-nf'>scatter</span><span class='hljl-p'>(</span><span class='hljl-sc'>:time</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>:CONC</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>color</span><span class='hljl-oB'>=:</span><span class='hljl-n'>black</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>markersize</span><span class='hljl-oB'>=</span><span class='hljl-ni'>8</span><span class='hljl-p'>,</span><span class='hljl-t'>
    </span><span class='hljl-n'>xlabel</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;Time (hours)&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>ylabel</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;Concentration (ng</span><span class='hljl-se'>\\</span><span class='hljl-s'>/mL)&quot;</span><span class='hljl-t'> </span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-nd'>@df</span><span class='hljl-t'> </span><span class='hljl-n'>subdf</span><span class='hljl-t'> </span><span class='hljl-nf'>plot!</span><span class='hljl-p'>(</span><span class='hljl-sc'>:time</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>:CONC_pred</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>color</span><span class='hljl-oB'>=:</span><span class='hljl-n'>red</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>linewidth</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-ni'>4</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-nd'>@df</span><span class='hljl-t'> </span><span class='hljl-n'>subdf</span><span class='hljl-t'> </span><span class='hljl-nf'>plot!</span><span class='hljl-p'>(</span><span class='hljl-sc'>:time</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>:CONC_ipred</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>color</span><span class='hljl-oB'>=:</span><span class='hljl-n'>blue</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>linewidth</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-ni'>4</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-k'>end</span><span class='hljl-t'>
</span><span class='hljl-cs'>#savefig(&quot;./assets/indplotswka.png&quot;)</span>
</pre>


<p><img src="./assets/indplotswka.png" alt="indplots withka" /></p>
<p>The randomly sampled individual fits don&#39;t seem good in some individuals, but we can evaluate this via a <code>vpc</code> to see how to go about.</p>
<p>We can now perform a <code>vpc</code> to check.</p>



<pre class='hljl'>
<span class='hljl-n'>pk_vpc</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>vpc</span><span class='hljl-p'>(</span><span class='hljl-n'>pkfit_2cmp_unfix_ka</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>200</span><span class='hljl-p'>;</span><span class='hljl-t'> </span><span class='hljl-n'>dv</span><span class='hljl-oB'>=:</span><span class='hljl-n'>CONC</span><span class='hljl-p'>,</span><span class='hljl-t'>
             </span><span class='hljl-n'>stratify_by</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>[</span><span class='hljl-sc'>:DOSE</span><span class='hljl-p'>],</span><span class='hljl-t'>
            </span><span class='hljl-n'>ensemblealg</span><span class='hljl-oB'>=</span><span class='hljl-nf'>EnsembleThreads</span><span class='hljl-p'>())</span><span class='hljl-t'>
</span><span class='hljl-nf'>plot</span><span class='hljl-p'>(</span><span class='hljl-n'>pk_vpc</span><span class='hljl-p'>,</span><span class='hljl-t'>
    </span><span class='hljl-n'>size</span><span class='hljl-oB'>=</span><span class='hljl-p'>(</span><span class='hljl-ni'>1800</span><span class='hljl-p'>,</span><span class='hljl-ni'>1800</span><span class='hljl-p'>),</span><span class='hljl-t'> </span><span class='hljl-n'>xlabel</span><span class='hljl-oB'>=</span><span class='hljl-s'>&quot;Time after dose (hours)&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'>
    </span><span class='hljl-n'>ylabel</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;CTMNopain concentration (ng/mL)&quot;</span><span class='hljl-t'> </span><span class='hljl-p'>,</span><span class='hljl-t'>
    </span><span class='hljl-n'>titlefontsize</span><span class='hljl-oB'>=</span><span class='hljl-ni'>20</span><span class='hljl-p'>,</span><span class='hljl-n'>guidefontsize</span><span class='hljl-oB'>=</span><span class='hljl-ni'>20</span><span class='hljl-p'>,</span><span class='hljl-t'>
    </span><span class='hljl-n'>markersize</span><span class='hljl-oB'>=</span><span class='hljl-ni'>10</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>markeralpha</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nfB'>0.5</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>markercolor</span><span class='hljl-t'> </span><span class='hljl-oB'>=:</span><span class='hljl-n'>grey</span><span class='hljl-p'>,</span><span class='hljl-t'>
    </span><span class='hljl-n'>observations</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-kc'>true</span><span class='hljl-p'>,</span><span class='hljl-t'>
    </span><span class='hljl-n'>observed_quantiles</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-kc'>true</span><span class='hljl-p'>,</span><span class='hljl-t'>
    </span><span class='hljl-n'>simquantile_medians</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-kc'>true</span><span class='hljl-p'>,</span><span class='hljl-t'>
    </span><span class='hljl-n'>ci_bands</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-kc'>true</span><span class='hljl-p'>,</span><span class='hljl-t'>
    </span><span class='hljl-n'>legend</span><span class='hljl-oB'>=</span><span class='hljl-kc'>true</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>legendfontsize</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>20</span><span class='hljl-p'>,</span><span class='hljl-t'>
    </span><span class='hljl-n'>titlefontcolor</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-sc'>:blue</span><span class='hljl-p'>,</span><span class='hljl-t'>
    </span><span class='hljl-n'>linewidth</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-ni'>10</span><span class='hljl-p'>,</span><span class='hljl-t'>
     </span><span class='hljl-n'>xtickfont</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>font</span><span class='hljl-p'>(</span><span class='hljl-ni'>25</span><span class='hljl-p'>),</span><span class='hljl-t'>
     </span><span class='hljl-n'>ytickfont</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>font</span><span class='hljl-p'>(</span><span class='hljl-ni'>25</span><span class='hljl-p'>))</span><span class='hljl-t'>
</span><span class='hljl-cs'>#savefig(&quot;./assets/pkvpc.png&quot;)</span>
</pre>


<p><img src="./assets/pkvpc.png" alt="Plot vpc" /></p>
<p>The visual predictive check suggests that the model captures the data well across all dose levels.</p>


        <HR/>
        <div class="footer">
          <p>
            Published from <a href="introduction.jmd">introduction.jmd</a>
            using <a href="http://github.com/JunoLab/Weave.jl">Weave.jl</a> v0.10.2 on 2020-08-09.
          </p>
        </div>
      </div>
    </div>
  </div>
</BODY>

</HTML>
